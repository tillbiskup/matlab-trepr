function varargout = trEPRgui_infowindow()
% TREPRGUI_INFOWINDOW Display information to a given dataset.
%
% Normally, this window is called from within the trEPRgui window.
%
% See also TREPRGUI

% (c) 2011, Till Biskup
% 2011-11-08

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  Construct the components
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Make GUI effectively a singleton
singleton = findobj('Tag','trepr_gui_infowindow');
if (singleton)
    figure(singleton);
    varargout{1} = singleton;
    return;
end

%  Construct the components
hMainFigure = figure('Tag','trepr_gui_infowindow',...
    'Visible','off',...
    'Name','trEPR GUI : Info Window',...
    'Units','Pixels',...
    'Position',[30,50,900,670],...
    'Resize','off',...
    'NumberTitle','off', ...
    'KeyPressFcn',@keypress_Callback,...
    'Menu','none','Toolbar','none');

defaultBackground = get(hMainFigure,'Color');
noneditableBackground = [0.92 0.92 0.92];
editableBackground = [1 1 1];
editableWarningBackground = [1 1 0.9];
editableErrorBackground = [1 0.85 0.85];
guiSize = get(hMainFigure,'Position');
guiSize = guiSize([3,4]);
panel_size = 240;
mainPanelWidth = 280;
mainPanelHeight = guiSize(2)-70;
subPanelHeight = guiSize(2)-120;

% Create main controls panels
mp = uipanel('Tag','main_controls_panel',...
    'parent',hMainFigure,...
    'Title','Main controls',...
    'FontUnit','Pixel','Fontsize',12,...
    'FontWeight','bold',...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'Position',[guiSize(1)-panel_size-40 70 panel_size+20 guiSize(2)-90]);

handle_mp1 = uipanel('Tag','main_panel_dataset_panel',...
    'Parent',mp,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 450 panel_size 100],...
    'Title','Select datasets'...
    );
uicontrol('Tag','main_panel_dataset_listbox',...
    'Style','listbox',...
    'Parent',handle_mp1,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 10 panel_size-20 70],...
    'String','',...
    'Callback',{@dataset_listbox_Callback}...
    );
handle_mp2 = uipanel('Tag','main_panel_togglebuttons_panel',...
    'Parent',mp,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 350 panel_size 90],...
    'Title','Select category'...
    );
% Create button group, toggle buttons for switching btw. panels
hButtonGroup = uibuttongroup('Tag','mainButtonGroup',...
    'BackgroundColor',defaultBackground,...
    'Parent',handle_mp2,...
    'BorderType','none',...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position', [10 10 panel_size-20 60],...
    'Visible','on',...
    'SelectionChangeFcn',{@tbg_Callback});
tb1 = uicontrol('Tag','general_togglebutton',...
    'Style','Toggle',...
	'Parent', hButtonGroup, ...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'String','General',...
    'TooltipString','Show general information about selected dataset',...
    'pos',[0 30 (panel_size-20)/2 30],...
    'Enable','on'...
    );
tb2 = uicontrol('Tag','parameters_togglebutton',...
    'Style','Toggle',...
	'Parent', hButtonGroup, ...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'String','Parameters',...
    'TooltipString','Show parameters of selected dataset',...
    'pos',[(panel_size-20)/2 30 (panel_size-20)/2 30],...
    'Enable','on'...
    );
tb3 = uicontrol('Tag','display_togglebutton',...
    'Style','Toggle',...
	'Parent', hButtonGroup, ...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'String','Display',...
    'TooltipString','Show display parameters of selected dataset',...
    'pos',[0 0 (panel_size-20)/2 30],...
    'Enable','on'...
    );
tb4 = uicontrol('Tag','history_togglebutton',...
    'Style','Toggle',...
	'Parent', hButtonGroup, ...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'String','History',...
    'TooltipString','Access full history of selected dataset',...
    'pos',[(panel_size-20)/2 0 (panel_size-20)/2 30],...
    'Enable','on'...
    );
handle_mp3 = uipanel('Tag','main_panel_about_panel',...
    'Parent',mp,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 200 panel_size 140],...
    'Title','About the current panel'...
    );
uicontrol('Tag','main_panel_about_text',...
    'Style','text',...
    'parent',handle_mp3,...
    'FontUnit','Pixel','Fontsize',12,...
    'FontAngle','italic',...
    'HorizontalAlignment','Left',...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'String','editable fields',...
    'Position',[10 10 panel_size-20 100]);

handle_mp4 = uipanel('Tag','main_panel_fieldtype_panel',...
    'Parent',mp,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 45 panel_size 145],...
    'Title','Colour codes of fields'...
    );
uipanel('Tag','main_panel_editablebg_panel',...
    'Parent',handle_mp4,...
    'BackgroundColor',editableBackground,...
    'BorderType','none',...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 100 20 20],...
    'Title',''...
    );
uicontrol('Tag','main_panel_editablebg_text',...
    'Style','text',...
    'parent',handle_mp4,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Left',...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'String','editable fields',...
    'Position',[40 100 panel_size-50 20]);
uipanel('Tag','main_panel_editablebg_panel',...
    'Parent',handle_mp4,...
    'BackgroundColor',editableWarningBackground,...
    'BorderType','none',...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 70 20 20],...
    'Title',''...
    );
uicontrol('Tag','main_panel_editablebg_text',...
    'Style','text',...
    'parent',handle_mp4,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Left',...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'String','editable, but be CAREFUL!',...
    'Position',[40 70 panel_size-50 20]);
uipanel('Tag','main_panel_editablebg_panel',...
    'Parent',handle_mp4,...
    'BackgroundColor',editableErrorBackground,...
    'BorderType','none',...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 40 20 20],...
    'Title',''...
    );
uicontrol('Tag','main_panel_editablebg_text',...
    'Style','text',...
    'parent',handle_mp4,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Left',...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'String','editable, wrong/missing value',...
    'Position',[40 40 panel_size-50 20]);
uipanel('Tag','main_panel_noneditablebg_panel',...
    'Parent',handle_mp4,...
    'BackgroundColor',noneditableBackground,...
    'BorderType','none',...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 10 20 20],...
    'Title',''...
    );
uicontrol('Tag','main_panel_noneditablebg_text',...
    'Style','text',...
    'parent',handle_mp4,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Left',...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'String','not editable fields',...
    'Position',[40 10 panel_size-50 20]);

uicontrol('Tag','help_pushbutton',...
    'Style','pushbutton',...
	'Parent', mp, ...
    'BackgroundColor',defaultBackground,...
    'ForegroundColor',[0 0 1],...
    'FontUnit','Pixel','Fontsize',12,...
    'FontWeight','bold',...
    'String','?',...
    'TooltipString','Display help for how to operate the info GUI',...
    'pos',[panel_size-15 10 25 25],...
    'Enable','on',...
    'Callback',@trEPRgui_info_helpwindow...
    );


% Create (switchable and overlaying) main panels
p1 = uipanel('Tag','general_panel',...
    'parent',hMainFigure,...
    'Title','General information',...
    'FontUnit','Pixel','Fontsize',12,...
    'FontWeight','bold',...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'Position',[20 20 guiSize(1)-mainPanelWidth-30 guiSize(2)-40]);

p2 = uipanel('Tag','parameter_panel',...
    'parent',hMainFigure,...
    'Title','Parameters of the measurement',...
    'FontUnit','Pixel','Fontsize',12,...
    'FontWeight','bold',...
    'BackgroundColor',defaultBackground,...
    'Visible','off',...
    'Units','pixels',...
    'Position',[20 20 guiSize(1)-mainPanelWidth-30 guiSize(2)-40]);

p3 = uipanel('Tag','display_panel',...
    'parent',hMainFigure,...
    'Title','Display settings',...
    'FontUnit','Pixel','Fontsize',12,...
    'FontWeight','bold',...
    'BackgroundColor',defaultBackground,...
    'Visible','off',...
    'Units','pixels',...
    'Position',[20 20 guiSize(1)-mainPanelWidth-30 guiSize(2)-40]);

p4 = uipanel('Tag','history_panel',...
    'parent',hMainFigure,...
    'Title','History',...
    'FontUnit','Pixel','Fontsize',12,...
    'FontWeight','bold',...
    'BackgroundColor',defaultBackground,...
    'Visible','off',...
    'Units','pixels',...
    'Position',[20 20 guiSize(1)-mainPanelWidth-30 guiSize(2)-40]);

% Controls for p1
p1p1 = uipanel('Tag','general_panel_filename_panel',...
    'parent',p1,...
    'Title','File',...
    'FontUnit','Pixel','Fontsize',12,...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'Position',[10 480 mainPanelWidth*2+10 120]);
uicontrol('Tag','general_panel_filepath_text',...
    'Style','text',...
    'parent',p1p1,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'String','Path ',...
    'Position',[10 70 60 20]);
uicontrol('Tag','general_panel_filepath_edit',...
    'Style','edit',...
    'parent',p1p1,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Left',...
    'BackgroundColor',noneditableBackground,...
    'Visible','on',...
    'Units','pixels',...
    'String','Path to file',...
    'Position',[80 70 mainPanelWidth*2-80 25]);
uicontrol('Tag','general_panel_filename_text',...
    'Style','text',...
    'parent',p1p1,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'String','Name ',...
    'Position',[10 40 60 20]);
uicontrol('Tag','general_panel_filename_edit',...
    'Style','edit',...
    'parent',p1p1,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Left',...
    'BackgroundColor',noneditableBackground,...
    'Visible','on',...
    'Units','pixels',...
    'String','Filename',...
    'Position',[80 40 mainPanelWidth*2-80 25]);
uicontrol('Tag','general_panel_fileformat_text',...
    'Style','text',...
    'parent',p1p1,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'String','Format ',...
    'Position',[10 10 60 20]);
uicontrol('Tag','general_panel_fileformat_edit',...
    'Style','edit',...
    'parent',p1p1,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Left',...
    'BackgroundColor',noneditableBackground,...
    'Visible','on',...
    'Units','pixels',...
    'String','File format',...
    'Position',[80 10 mainPanelWidth*2-80 25]);

p1p2 = uipanel('Tag','general_panel_label_panel',...
    'parent',p1,...
    'Title','Dataset',...
    'FontUnit','Pixel','Fontsize',12,...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'Position',[10 410 mainPanelWidth*2+10 60]);
uicontrol('Tag','general_panel_label_text',...
    'Style','text',...
    'parent',p1p2,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'String','Label ',...
    'Position',[10 10 60 20]);
uicontrol('Tag','general_panel_label_edit',...
    'Style','edit',...
    'parent',p1p2,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Left',...
    'BackgroundColor',editableBackground,...
    'Visible','on',...
    'Units','pixels',...
    'String','',...
    'Position',[80 10 mainPanelWidth*2-80 25],...
    'Callback',{@general_edit_Callback,'label'}...
    );

p1p3 = uipanel('Tag','general_panel_header_panel',...
    'parent',p1,...
    'Title','Header',...
    'FontUnit','Pixel','Fontsize',12,...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'Position',[10 120 mainPanelWidth*2+10 280]);
uicontrol('Tag','general_panel_header_edit',...
    'Style','edit',...
    'parent',p1p3,...
    'FontUnit','Pixel','Fontsize',12,...
    'FontName','FixedWidth',...
    'HorizontalAlignment','Left',...
    'BackgroundColor',noneditableBackground,...
    'Max',2,'Min',0,...
    'Visible','on',...
    'Units','pixels',...
    'String',{'  1: Header with line numbers','  2: ','  3: '},...
    'Position',[10 10 mainPanelWidth*2-10 250]);

p1p4 = uipanel('Tag','general_panel_header_panel',...
    'parent',p1,...
    'Title','Comment',...
    'FontUnit','Pixel','Fontsize',12,...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'Position',[10 10 mainPanelWidth*2+10 100]);
uicontrol('Tag','general_panel_comment_edit',...
    'Style','edit',...
    'parent',p1p4,...
    'FontUnit','Pixel','Fontsize',12,...
    'FontName','FixedWidth',...
    'HorizontalAlignment','Left',...
    'BackgroundColor',noneditableBackground,...
    'Max',2,'Min',0,...
    'Visible','on',...
    'Units','pixels',...
    'String',{'  1: Comment with line numbers','  2: ','  3: '},...
    'Position',[10 10 mainPanelWidth*2-10 70]);


% Controls for p2
hParameterButtonGroup = uibuttongroup('Tag','parametersButtonGroup',...
    'BackgroundColor',defaultBackground,...
    'Parent',p2,...
    'BorderType','none',...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position', [10 mainPanelHeight-30 panel_size-20 30],...
    'Visible','on',...
    'SelectionChangeFcn',{@ptbg_Callback});
uicontrol('Tag','parameter_page1_togglebutton',...
    'Style','Toggle',...
	'Parent', hParameterButtonGroup, ...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'String','Page 1',...
    'TooltipString','Display parameters for sample, general, transient, field',...
    'pos',[0 0 (panel_size-20)/2 30],...
    'Enable','on'...
    );
uicontrol('Tag','parameter_page2_togglebutton',...
    'Style','Toggle',...
	'Parent', hParameterButtonGroup, ...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'String','Page 2',...
    'TooltipString','Display parameters for bridge, recorder, laser',...
    'pos',[(panel_size-20)/2 0 (panel_size-20)/2 30],...
    'Enable','on'...
    );
p2pp1 = uipanel('Tag','parameter_page1_panel',...
    'parent',p2,...
    'Title','',...
    'FontUnit','Pixel','Fontsize',12,...
    'BackgroundColor',defaultBackground,...
    'BorderType','none',...
    'Visible','on',...
    'Units','pixels',...
    'Position',[10 10 mainPanelWidth*2+10 mainPanelHeight-50]);
p2pp2 = uipanel('Tag','parameter_page2_panel',...
    'parent',p2,...
    'Title','',...
    'FontUnit','Pixel','Fontsize',12,...
    'BackgroundColor',defaultBackground,...
    'BorderType','none',...
    'Visible','off',...
    'Units','pixels',...
    'Position',[10 10 mainPanelWidth*2+10 mainPanelHeight-50]);

p2p1 = uipanel('Tag','parameter_general_panel',...
    'parent',p2pp1,...
    'Title','Sample',...
    'FontUnit','Pixel','Fontsize',12,...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'Position',[0 subPanelHeight-210 mainPanelWidth*2+10 210]);
uicontrol('Tag','parameter_panel_samplename_text',...
    'Style','text',...
    'Parent',p2p1,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 160 90 20],...
    'String','Name '...
    );
uicontrol('Tag','parameter_panel_samplename_edit',...
    'Style','edit',...
    'Parent',p2p1,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Left',...
    'Units','Pixels',...
    'Position',[110 160 mainPanelWidth*2-110 25],...
    'String','N/A',...
    'Callback',{@parameter_edit_Callback,'samplename'}...
    );
uicontrol('Tag','parameter_panel_sampletube_text',...
    'Style','text',...
    'Parent',p2p1,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 130 90 20],...
    'String','Tube '...
    );
uicontrol('Tag','parameter_panel_sampletube_edit',...
    'Style','edit',...
    'Parent',p2p1,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Left',...
    'Units','Pixels',...
    'Position',[110 130 mainPanelWidth-120 25],...
    'String','N/A',...
    'Callback',{@parameter_edit_Callback,'sampletube'}...
    );
uicontrol('Tag','parameter_panel_sampledescription_text',...
    'Style','text',...
    'Parent',p2p1,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 100 90 20],...
    'String','Description '...
    );
uicontrol('Tag','parameter_panel_sampledescription_edit',...
    'Style','edit',...
    'Parent',p2p1,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'FontName','FixedWidth',...
    'HorizontalAlignment','Left',...
    'Units','Pixels',...
    'Position',[110 70 mainPanelWidth*2-110 55],...
    'Max',2,'Min',0,...
    'String','N/A',...
    'Callback',{@parameter_edit_Callback,'sampledescription'}...
    );
uicontrol('Tag','parameter_panel_samplepreparation_text',...
    'Style','text',...
    'Parent',p2p1,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 40 90 20],...
    'String','Preparation '...
    );
uicontrol('Tag','parameter_panel_samplepreparation_edit',...
    'Style','edit',...
    'Parent',p2p1,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'FontName','FixedWidth',...
    'HorizontalAlignment','Left',...
    'Units','Pixels',...
    'Position',[110 10 mainPanelWidth*2-110 55],...
    'Max',2,'Min',0,...
    'String','N/A',...
    'Callback',{@parameter_edit_Callback,'samplepreparation'}...
    );

p2p2 = uipanel('Tag','parameter_general_panel',...
    'parent',p2pp1,...
    'Title','General',...
    'FontUnit','Pixel','Fontsize',12,...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'Position',[0 subPanelHeight-370 mainPanelWidth 150]);
uicontrol('Tag','parameter_panel_date_text',...
    'Style','text',...
    'Parent',p2p2,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 100 90 20],...
    'String','Date '...
    );
uicontrol('Tag','parameter_panel_date_edit',...
    'Style','edit',...
    'Parent',p2p2,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110 100 mainPanelWidth-120 25],...
    'String','yyyy-mm-dd',...
    'Callback',{@parameter_edit_Callback,'date'}...
    );
uicontrol('Tag','parameter_panel_operator_text',...
    'Style','text',...
    'Parent',p2p2,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 70 90 20],...
    'String','Operator '...
    );
uicontrol('Tag','parameter_panel_operator_edit',...
    'Style','edit',...
    'Parent',p2p2,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110 70 mainPanelWidth-120 25],...
    'String','N/A',...
    'Callback',{@parameter_edit_Callback,'operator'}...
    );
uicontrol('Tag','parameter_panel_nruns_text',...
    'Style','text',...
    'Parent',p2p2,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 40 90 20],...
    'String','No. of runs '...
    );
uicontrol('Tag','parameter_panel_nruns_edit',...
    'Style','edit',...
    'Parent',p2p2,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110 40 mainPanelWidth-120 25],...
    'String','0',...
    'Callback',{@parameter_edit_Callback,'nruns'}...
    );
uicontrol('Tag','parameter_panel_temperature_text',...
    'Style','text',...
    'Parent',p2p2,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 10 90 20],...
    'String','Temperature '...
    );
uicontrol('Tag','parameter_panel_temperature_edit',...
    'Style','edit',...
    'Parent',p2p2,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110 10 (mainPanelWidth-120)/3*2 25],...
    'String','0',...
    'Callback',{@parameter_edit_Callback,'temperature'}...
    );
uicontrol('Tag','parameter_panel_temperature_unit_edit',...
    'Style','edit',...
    'Parent',p2p2,...
    'BackgroundColor',editableWarningBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110+(mainPanelWidth-120)/3*2 10 (mainPanelWidth-120)/3 25],...
    'String','K',...
    'Callback',{@parameter_edit_Callback,'temperatureunit'}...
    );

p2p3 = uipanel('Tag','parameter_panel_axislabels_panel',...
    'Parent',p2pp1,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[0 subPanelHeight-520 mainPanelWidth 140],...
    'Title','Axis labels'...
    );
uicontrol('Tag','parameter_panel_measure_text',...
    'Style','text',...
    'Parent',p2p3,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60 90 (mainPanelWidth-70)/3*2 25],...
    'String','Measure'...
    );
uicontrol('Tag','parameter_panel_unit_text',...
    'Style','text',...
    'Parent',p2p3,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60+(mainPanelWidth-70)/3*2 90 (mainPanelWidth-70)/3 25],...
    'String','Unit'...
    );
uicontrol('Tag','parameter_panel_x_text',...
    'Style','text',...
    'Parent',p2p3,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 70 40 20],...
    'String','x '...
    );
uicontrol('Tag','parameter_panel_xmeasure_edit',...
    'Style','edit',...
    'Parent',p2p3,...
    'BackgroundColor',[1 1 1],...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60 70 (mainPanelWidth-70)/3*2 25],...
    'String','index',...
    'Callback',{@parameter_edit_Callback,'xmeasure'}...
    );
uicontrol('Tag','parameter_panel_xunit_edit',...
    'Style','edit',...
    'Parent',p2p3,...
    'BackgroundColor',[1 1 1],...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60+(mainPanelWidth-70)/3*2 70 (mainPanelWidth-70)/3 25],...
    'String','points',...
    'Callback',{@parameter_edit_Callback,'xunit'}...
    );
uicontrol('Tag','parameter_panel_y_text',...
    'Style','text',...
    'Parent',p2p3,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 40 40 20],...
    'String','y '...
    );
uicontrol('Tag','parameter_panel_ymeasure_edit',...
    'Style','edit',...
    'Parent',p2p3,...
    'BackgroundColor',[1 1 1],...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60 40 (mainPanelWidth-70)/3*2 25],...
    'String','index',...
    'Callback',{@parameter_edit_Callback,'ymeasure'}...
    );
uicontrol('Tag','parameter_panel_yunit_edit',...
    'Style','edit',...
    'Parent',p2p3,...
    'BackgroundColor',[1 1 1],...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60+(mainPanelWidth-70)/3*2 40 (mainPanelWidth-70)/3 25],...
    'String','points',...
    'Callback',{@parameter_edit_Callback,'yunit'}...
    );
uicontrol('Tag','parameter_panel_z_text',...
    'Style','text',...
    'Parent',p2p3,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 10 40 20],...
    'String','z '...
    );
uicontrol('Tag','parameter_panel_zmeasure_edit',...
    'Style','edit',...
    'Parent',p2p3,...
    'BackgroundColor',[1 1 1],...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60 10 (mainPanelWidth-70)/3*2 25],...
    'String','index',...
    'Callback',{@parameter_edit_Callback,'zmeasure'}...
    );
uicontrol('Tag','parameter_panel_zunit_edit',...
    'Style','edit',...
    'Parent',p2p3,...
    'BackgroundColor',[1 1 1],...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60+(mainPanelWidth-70)/3*2 10 (mainPanelWidth-70)/3 25],...
    'String','points',...
    'Callback',{@parameter_edit_Callback,'zunit'}...
    );

p2p4 = uipanel('Tag','parameter_field_panel',...
    'parent',p2pp1,...
    'Title','Field',...
    'FontUnit','Pixel','Fontsize',12,...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'Position',[mainPanelWidth+10 subPanelHeight-530 mainPanelWidth 310]);
uicontrol('Tag','parameter_panel_fieldpts_text',...
    'Style','text',...
    'Parent',p2p4,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 260 90 20],...
    'String','Dimension '...
    );
uicontrol('Tag','parameter_panel_fieldpts_edit',...
    'Style','edit',...
    'Parent',p2p4,...
    'BackgroundColor',noneditableBackground,...
    'Enable','Inactive',...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110 260 (mainPanelWidth-120)/3*2 25],...
    'String','0'...
    );
uicontrol('Tag','parameter_panel_fieldpts_unit_edit',...
    'Style','edit',...
    'Parent',p2p4,...
    'BackgroundColor',noneditableBackground,...
    'Enable','Inactive',...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110+(mainPanelWidth-120)/3*2 260 (mainPanelWidth-120)/3 25],...
    'String','pt'...
    );
uicontrol('Tag','parameter_panel_fieldstart_text',...
    'Style','text',...
    'Parent',p2p4,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 230 90 20],...
    'String','Start '...
    );
uicontrol('Tag','parameter_panel_fieldstart_edit',...
    'Style','edit',...
    'Parent',p2p4,...
    'BackgroundColor',editableWarningBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110 230 (mainPanelWidth-120)/3*2 25],...
    'String','0',...
    'Callback',{@parameter_edit_Callback,'fieldstart'}...
    );
uicontrol('Tag','parameter_panel_fieldstartunit_edit',...
    'Style','edit',...
    'Parent',p2p4,...
    'BackgroundColor',editableWarningBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110+(mainPanelWidth-120)/3*2 230 (mainPanelWidth-120)/3 25],...
    'String','G',...
    'Callback',{@parameter_edit_Callback,'fieldstartunit'}...
    );
uicontrol('Tag','parameter_panel_fieldend_text',...
    'Style','text',...
    'Parent',p2p4,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 200 90 20],...
    'String','End '...
    );
uicontrol('Tag','parameter_panel_fieldend_edit',...
    'Style','edit',...
    'Parent',p2p4,...
    'BackgroundColor',editableWarningBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110 200 (mainPanelWidth-120)/3*2 25],...
    'String','0',...
    'Callback',{@parameter_edit_Callback,'fieldend'}...
    );
uicontrol('Tag','parameter_panel_fieldendunit_edit',...
    'Style','edit',...
    'Parent',p2p4,...
    'BackgroundColor',editableWarningBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110+(mainPanelWidth-120)/3*2 200 (mainPanelWidth-120)/3 25],...
    'String','G',...
    'Callback',{@parameter_edit_Callback,'fieldendunit'}...
    );
uicontrol('Tag','parameter_panel_fieldstep_text',...
    'Style','text',...
    'Parent',p2p4,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 170 90 20],...
    'String','Step '...
    );
uicontrol('Tag','parameter_panel_fieldstep_edit',...
    'Style','edit',...
    'Parent',p2p4,...
    'BackgroundColor',editableWarningBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110 170 (mainPanelWidth-120)/3*2 25],...
    'String','0',...
    'Callback',{@parameter_edit_Callback,'fieldstep'}...
    );
uicontrol('Tag','parameter_panel_fieldstepunit_edit',...
    'Style','edit',...
    'Parent',p2p4,...
    'BackgroundColor',editableWarningBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110+(mainPanelWidth-120)/3*2 170 (mainPanelWidth-120)/3 25],...
    'String','G',...
    'Callback',{@parameter_edit_Callback,'fieldstepunit'}...
    );
uicontrol('Tag','parameter_panel_fieldcontroller_text',...
    'Style','text',...
    'Parent',p2p4,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 140 90 20],...
    'String','Controller '...
    );
uicontrol('Tag','parameter_panel_fieldcontroller_edit',...
    'Style','edit',...
    'Parent',p2p4,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110 140 (mainPanelWidth-120) 25],...
    'String','N/A',...
    'Callback',{@parameter_edit_Callback,'fieldcontroller'}...
    );
uicontrol('Tag','parameter_panel_calibration_text',...
    'Style','text',...
    'Parent',p2p4,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'FontAngle','oblique',...
    'Units','Pixels',...
    'Position',[10 100 mainPanelWidth-20 20],...
    'String','Calibration '...
    );
uicontrol('Tag','parameter_panel_fieldstartcalibrated_text',...
    'Style','text',...
    'Parent',p2p4,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 70 90 20],...
    'String','Calib. start '...
    );
uicontrol('Tag','parameter_panel_fieldstartcalibrated_edit',...
    'Style','edit',...
    'Parent',p2p4,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110 70 (mainPanelWidth-120)/3*2 25],...
    'String','N/A',...
    'Callback',{@parameter_edit_Callback,'fieldstartcalibrated'}...
    );
uicontrol('Tag','parameter_panel_fieldstartcalibratedunit_edit',...
    'Style','edit',...
    'Parent',p2p4,...
    'BackgroundColor',editableWarningBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110+(mainPanelWidth-120)/3*2 70 (mainPanelWidth-120)/3 25],...
    'String','G',...
    'Callback',{@parameter_edit_Callback,'fieldstartcalibratedunit'}...
    );
uicontrol('Tag','parameter_panel_fieldendcalibrated_text',...
    'Style','text',...
    'Parent',p2p4,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 40 90 20],...
    'String','Calib. end '...
    );
uicontrol('Tag','parameter_panel_fieldendcalibrated_edit',...
    'Style','edit',...
    'Parent',p2p4,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110 40 (mainPanelWidth-120)/3*2 25],...
    'String','N/A',...
    'Callback',{@parameter_edit_Callback,'fieldendcalibrated'}...
    );
uicontrol('Tag','parameter_panel_fieldendcalibratedunit_edit',...
    'Style','edit',...
    'Parent',p2p4,...
    'BackgroundColor',editableWarningBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110+(mainPanelWidth-120)/3*2 40 (mainPanelWidth-120)/3 25],...
    'String','G',...
    'Callback',{@parameter_edit_Callback,'fieldendcalibratedunit'}...
    );
uicontrol('Tag','parameter_panel_fieldprobe_text',...
    'Style','text',...
    'Parent',p2p4,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 10 90 20],...
    'String','Gaussmeter '...
    );
uicontrol('Tag','parameter_panel_fieldprobe_edit',...
    'Style','edit',...
    'Parent',p2p4,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110 10 (mainPanelWidth-120) 25],...
    'String','N/A',...
    'Callback',{@parameter_edit_Callback,'fieldcalibratedprobe'}...
    );

p2p5 = uipanel('Tag','parameter_transient_panel',...
    'parent',p2pp2,...
    'Title','Transient',...
    'FontUnit','Pixel','Fontsize',12,...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'Position',[0 subPanelHeight-120 mainPanelWidth 120]);
uicontrol('Tag','parameter_panel_npts_text',...
    'Style','text',...
    'Parent',p2p5,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 70 90 20],...
    'String','Dimension '...
    );
uicontrol('Tag','parameter_panel_npts_edit',...
    'Style','edit',...
    'Parent',p2p5,...
    'BackgroundColor',noneditableBackground,...
    'Enable','Inactive',...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110 70 (mainPanelWidth-120)/3*2 25],...
    'String','0'...
    );
uicontrol('Tag','parameter_panel_npts_unit_edit',...
    'Style','edit',...
    'Parent',p2p5,...
    'BackgroundColor',noneditableBackground,...
    'Enable','Inactive',...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110+(mainPanelWidth-120)/3*2 70 (mainPanelWidth-120)/3 25],...
    'String','pt'...
    );
uicontrol('Tag','parameter_panel_triggerposition_text',...
    'Style','text',...
    'Parent',p2p5,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 40 90 20],...
    'String','Trigger pos. '...
    );
uicontrol('Tag','parameter_panel_triggerposition_edit',...
    'Style','edit',...
    'Parent',p2p5,...
    'BackgroundColor',editableWarningBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110 40 (mainPanelWidth-120)/3*2 25],...
    'String','0',...
    'Callback',{@parameter_edit_Callback,'triggerposition'}...
    );
uicontrol('Tag','parameter_panel_triggerposition_unit_edit',...
    'Style','edit',...
    'Parent',p2p5,...
    'BackgroundColor',noneditableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110+(mainPanelWidth-120)/3*2 40 (mainPanelWidth-120)/3 25],...
    'String','pt'...
    );
uicontrol('Tag','parameter_panel_length_text',...
    'Style','text',...
    'Parent',p2p5,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 10 90 20],...
    'String','Length '...
    );
uicontrol('Tag','parameter_panel_length_edit',...
    'Style','edit',...
    'Parent',p2p5,...
    'BackgroundColor',editableWarningBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110 10 (mainPanelWidth-120)/3*2 25],...
    'String','0',...
    'Callback',{@parameter_edit_Callback,'transientlength'}...
    );
uicontrol('Tag','parameter_panel_length_unit_edit',...
    'Style','edit',...
    'Parent',p2p5,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110+(mainPanelWidth-120)/3*2 10 (mainPanelWidth-120)/3 25],...
    'String','us',...
    'Callback',{@parameter_edit_Callback,'transientlengthunit'}...
    );

p2p6 = uipanel('Tag','parameter_bridge_panel',...
    'parent',p2pp2,...
    'Title','Bridge',...
    'FontUnit','Pixel','Fontsize',12,...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'Position',[0 subPanelHeight-510 mainPanelWidth 380]);
uicontrol('Tag','parameter_panel_bridgemodel_text',...
    'Style','text',...
    'Parent',p2p6,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 330 90 20],...
    'String','Model '...
    );
uicontrol('Tag','parameter_panel_bridgemodel_edit',...
    'Style','edit',...
    'Parent',p2p6,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Left',...
    'Units','Pixels',...
    'Position',[110 330 mainPanelWidth-120 25],...
    'String','N/A',...
    'Callback',{@parameter_edit_Callback,'bridgemodel'}...
    );
uicontrol('Tag','parameter_panel_mwfrequency_text',...
    'Style','text',...
    'Parent',p2p6,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 300 90 20],...
    'String','MW frequency '...
    );
uicontrol('Tag','parameter_panel_mwfrequency_edit',...
    'Style','edit',...
    'Parent',p2p6,...
    'BackgroundColor',editableWarningBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110 300 (mainPanelWidth-120)/3*2 25],...
    'String','0',...
    'Callback',{@parameter_edit_Callback,'mwfrequency'}...
    );
uicontrol('Tag','parameter_panel_mwfrequencyunit_edit',...
    'Style','edit',...
    'Parent',p2p6,...
    'BackgroundColor',noneditableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110+(mainPanelWidth-120)/3*2 300 (mainPanelWidth-120)/3 25],...
    'String','GHz'...
    );
uicontrol('Tag','parameter_panel_attenuation_text',...
    'Style','text',...
    'Parent',p2p6,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 270 90 20],...
    'String','Attenuation '...
    );
uicontrol('Tag','parameter_panel_attenuation_edit',...
    'Style','edit',...
    'Parent',p2p6,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110 270 (mainPanelWidth-120)/3*2 25],...
    'String','0',...
    'Callback',{@parameter_edit_Callback,'bridgeattenuation'}...
    );
uicontrol('Tag','parameter_panel_attenuationunit_edit',...
    'Style','edit',...
    'Parent',p2p6,...
    'BackgroundColor',noneditableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110+(mainPanelWidth-120)/3*2 270 (mainPanelWidth-120)/3 25],...
    'String','dB'...
    );
uicontrol('Tag','parameter_panel_mwpower_text',...
    'Style','text',...
    'Parent',p2p6,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 240 90 20],...
    'String','Power '...
    );
uicontrol('Tag','parameter_panel_mwpower_edit',...
    'Style','edit',...
    'Parent',p2p6,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110 240 (mainPanelWidth-120)/3*2 25],...
    'String','0',...
    'Callback',{@parameter_edit_Callback,'mwpower'}...
    );
uicontrol('Tag','parameter_panel_mwpowerunit_edit',...
    'Style','edit',...
    'Parent',p2p6,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110+(mainPanelWidth-120)/3*2 240 (mainPanelWidth-120)/3 25],...
    'String','mW',...
    'Callback',{@parameter_edit_Callback,'mwpowerunit'}...
    );
uicontrol('Tag','parameter_panel_videoamplifier_text',...
    'Style','text',...
    'Parent',p2p6,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'FontAngle','oblique',...
    'Units','Pixels',...
    'Position',[10 200 mainPanelWidth-20 20],...
    'String','Video amplifier '...
    );
uicontrol('Tag','parameter_panel_bandwidth_text',...
    'Style','text',...
    'Parent',p2p6,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 170 90 20],...
    'String','Bandwidth '...
    );
uicontrol('Tag','parameter_panel_bandwidth_edit',...
    'Style','edit',...
    'Parent',p2p6,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110 170 (mainPanelWidth-120)/3*2 25],...
    'String','0',...
    'Callback',{@parameter_edit_Callback,'bridgebandwidth'}...
    );
uicontrol('Tag','parameter_panel_bandwidthunit_edit',...
    'Style','edit',...
    'Parent',p2p6,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110+(mainPanelWidth-120)/3*2 170 (mainPanelWidth-120)/3 25],...
    'String','mW',...
    'Callback',{@parameter_edit_Callback,'bridgebandwidthunit'}...
    );
uicontrol('Tag','parameter_panel_amplification_text',...
    'Style','text',...
    'Parent',p2p6,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 140 90 20],...
    'String','Amplification '...
    );
uicontrol('Tag','parameter_panel_amplification_edit',...
    'Style','edit',...
    'Parent',p2p6,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110 140 (mainPanelWidth-120)/3*2 25],...
    'String','0',...
    'Callback',{@parameter_edit_Callback,'videoamplification'}...
    );
uicontrol('Tag','parameter_panel_amplificationunit_edit',...
    'Style','edit',...
    'Parent',p2p6,...
    'BackgroundColor',noneditableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110+(mainPanelWidth-120)/3*2 140 (mainPanelWidth-120)/3 25],...
    'String','dB'...
    );
uicontrol('Tag','parameter_panel_mwcalibration_text',...
    'Style','text',...
    'Parent',p2p6,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'FontAngle','oblique',...
    'Units','Pixels',...
    'Position',[10 100 mainPanelWidth-20 20],...
    'String','Calibration '...
    );
uicontrol('Tag','parameter_panel_mwcalibratedstart_text',...
    'Style','text',...
    'Parent',p2p6,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 70 90 20],...
    'String','Freq. @ start '...
    );
uicontrol('Tag','parameter_panel_mwcalibratedstart_edit',...
    'Style','edit',...
    'Parent',p2p6,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110 70 (mainPanelWidth-120)/3*2 25],...
    'String','N/A',...
    'Callback',{@parameter_edit_Callback,'mwcalibratedstart'}...
    );
uicontrol('Tag','parameter_panel_mwcalibratedstartunit_edit',...
    'Style','edit',...
    'Parent',p2p6,...
    'BackgroundColor',noneditableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110+(mainPanelWidth-120)/3*2 70 (mainPanelWidth-120)/3 25],...
    'String','GHz'...
    );
uicontrol('Tag','parameter_panel_mwcalibratedend_text',...
    'Style','text',...
    'Parent',p2p6,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 40 90 20],...
    'String','Freq. @ end '...
    );
uicontrol('Tag','parameter_panel_mwcalibratedend_edit',...
    'Style','edit',...
    'Parent',p2p6,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110 40 (mainPanelWidth-120)/3*2 25],...
    'String','N/A',...
    'Callback',{@parameter_edit_Callback,'mwcalibratedend'}...
    );
uicontrol('Tag','parameter_panel_mwcalibratedendunit_edit',...
    'Style','edit',...
    'Parent',p2p6,...
    'BackgroundColor',noneditableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110+(mainPanelWidth-120)/3*2 40 (mainPanelWidth-120)/3 25],...
    'String','GHz'...
    );
uicontrol('Tag','parameter_panel_mwcounter_text',...
    'Style','text',...
    'Parent',p2p6,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 10 90 20],...
    'String','Freq. counter '...
    );
uicontrol('Tag','parameter_panel_mwcounter_edit',...
    'Style','edit',...
    'Parent',p2p6,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Left',...
    'Units','Pixels',...
    'Position',[110 10 mainPanelWidth-120 25],...
    'String','N/A',...
    'Callback',{@parameter_edit_Callback,'mwcounter'}...
    );

p2p7 = uipanel('Tag','parameter_probehead_panel',...
    'parent',p2pp2,...
    'Title','Probehead',...
    'FontUnit','Pixel','Fontsize',12,...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'Position',[mainPanelWidth+10 subPanelHeight-60 mainPanelWidth 60]);
uicontrol('Tag','parameter_panel_probehead_text',...
    'Style','text',...
    'Parent',p2p7,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 10 90 20],...
    'String','Model '...
    );
uicontrol('Tag','parameter_panel_probehead_edit',...
    'Style','edit',...
    'Parent',p2p7,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Left',...
    'Units','Pixels',...
    'Position',[110 10 mainPanelWidth-120 25],...
    'String','N/A',...
    'Callback',{@parameter_edit_Callback,'probehead'}...
    );

p2p8 = uipanel('Tag','parameter_recorder_panel',...
    'parent',p2pp2,...
    'Title','Recorder',...
    'FontUnit','Pixel','Fontsize',12,...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'Position',[mainPanelWidth+10 subPanelHeight-310 mainPanelWidth 240]);
uicontrol('Tag','parameter_panel_recordermodel_text',...
    'Style','text',...
    'Parent',p2p8,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 190 90 20],...
    'String','Model '...
    );
uicontrol('Tag','parameter_panel_recordermodel_edit',...
    'Style','edit',...
    'Parent',p2p8,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Left',...
    'Units','Pixels',...
    'Position',[110 190 mainPanelWidth-120 25],...
    'String','N/A',...
    'Callback',{@parameter_edit_Callback,'recordermodel'}...
    );
uicontrol('Tag','parameter_panel_averages_text',...
    'Style','text',...
    'Parent',p2p8,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 160 90 20],...
    'String','Averages '...
    );
uicontrol('Tag','parameter_panel_averages_edit',...
    'Style','edit',...
    'Parent',p2p8,...
    'BackgroundColor',editableWarningBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110 160 mainPanelWidth-120 25],...
    'String','0',...
    'Callback',{@parameter_edit_Callback,'averages'}...
    );
uicontrol('Tag','parameter_panel_recordercoupling_text',...
    'Style','text',...
    'Parent',p2p8,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 130 90 20],...
    'String','Coupling '...
    );
uicontrol('Tag','parameter_panel_recordercoupling_edit',...
    'Style','edit',...
    'Parent',p2p8,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110 130 mainPanelWidth-120 25],...
    'String','',...
    'Callback',{@parameter_edit_Callback,'recordercoupling'}...
    );
uicontrol('Tag','parameter_panel_recorderimpedance_text',...
    'Style','text',...
    'Parent',p2p8,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 100 90 20],...
    'String','Impedance '...
    );
uicontrol('Tag','parameter_panel_recorderimpedance_edit',...
    'Style','edit',...
    'Parent',p2p8,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110 100 (mainPanelWidth-120)/3*2 25],...
    'String','0',...
    'Callback',{@parameter_edit_Callback,'recorderimpedance'}...
    );
uicontrol('Tag','parameter_panel_recorderimpedanceunit_edit',...
    'Style','edit',...
    'Parent',p2p8,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110+(mainPanelWidth-120)/3*2 100 (mainPanelWidth-120)/3 25],...
    'String','MOhm',...
    'Callback',{@parameter_edit_Callback,'recorderimpedanceunit'}...
    );
uicontrol('Tag','parameter_panel_timebase_text',...
    'Style','text',...
    'Parent',p2p8,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 70 90 20],...
    'String','Time base '...
    );
uicontrol('Tag','parameter_panel_timebase_edit',...
    'Style','edit',...
    'Parent',p2p8,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110 70 (mainPanelWidth-120)/3*2 25],...
    'String','0',...
    'Callback',{@parameter_edit_Callback,'recordertimebase'}...
    );
uicontrol('Tag','parameter_panel_timebaseunit_edit',...
    'Style','edit',...
    'Parent',p2p8,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110+(mainPanelWidth-120)/3*2 70 (mainPanelWidth-120)/3 25],...
    'String','us',...
    'Callback',{@parameter_edit_Callback,'recordertimebaseunit'}...
    );
uicontrol('Tag','parameter_panel_bandwidth_text',...
    'Style','text',...
    'Parent',p2p8,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 40 90 20],...
    'String','Bandwidth '...
    );
uicontrol('Tag','parameter_panel_bandwidth_edit',...
    'Style','edit',...
    'Parent',p2p8,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110 40 (mainPanelWidth-120)/3*2 25],...
    'String','0',...
    'Callback',{@parameter_edit_Callback,'recorderbandwidth'}...
    );
uicontrol('Tag','parameter_panel_bandwidthunit_edit',...
    'Style','edit',...
    'Parent',p2p8,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110+(mainPanelWidth-120)/3*2 40 (mainPanelWidth-120)/3 25],...
    'String','MHz',...
    'Callback',{@parameter_edit_Callback,'recorderbandwidthunit'}...
    );
uicontrol('Tag','parameter_panel_sensitivity_text',...
    'Style','text',...
    'Parent',p2p8,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 10 90 20],...
    'String','Sensitivity '...
    );
uicontrol('Tag','parameter_panel_sensitivity_edit',...
    'Style','edit',...
    'Parent',p2p8,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110 10 (mainPanelWidth-120)/3*2 25],...
    'String','0',...
    'Callback',{@parameter_edit_Callback,'recordersensitivity'}...
    );
uicontrol('Tag','parameter_panel_sensitivity_unit_edit',...
    'Style','edit',...
    'Parent',p2p8,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110+(mainPanelWidth-120)/3*2 10 (mainPanelWidth-120)/3 25],...
    'String','mV',...
    'Callback',{@parameter_edit_Callback,'recordersensitivityunit'}...
    );

p2p9 = uipanel('Tag','parameter_laser_panel',...
    'parent',p2pp2,...
    'Title','Laser',...
    'FontUnit','Pixel','Fontsize',12,...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'Position',[mainPanelWidth+10 subPanelHeight-500 mainPanelWidth 180]);
uicontrol('Tag','parameter_panel_lasermodel_text',...
    'Style','text',...
    'Parent',p2p9,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 130 90 20],...
    'String','Model '...
    );
uicontrol('Tag','parameter_panel_lasermodel_edit',...
    'Style','edit',...
    'Parent',p2p9,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Left',...
    'Units','Pixels',...
    'Position',[110 130 mainPanelWidth-120 25],...
    'String','N/A',...
    'Callback',{@parameter_edit_Callback,'lasermodel'}...
    );
uicontrol('Tag','parameter_panel_opodye_text',...
    'Style','text',...
    'Parent',p2p9,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 100 90 20],...
    'String','OPO / Dye '...
    );
uicontrol('Tag','parameter_panel_opodye_edit',...
    'Style','edit',...
    'Parent',p2p9,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Left',...
    'Units','Pixels',...
    'Position',[110 100 mainPanelWidth-120 25],...
    'String','N/A',...
    'Callback',{@parameter_edit_Callback,'opodye'}...
    );
uicontrol('Tag','parameter_panel_wavelength_text',...
    'Style','text',...
    'Parent',p2p9,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 70 90 20],...
    'String','Wavelength '...
    );
uicontrol('Tag','parameter_panel_wavelength_edit',...
    'Style','edit',...
    'Parent',p2p9,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110 70 (mainPanelWidth-120)/3*2 25],...
    'String','0',...
    'Callback',{@parameter_edit_Callback,'laserwavelength'}...
    );
uicontrol('Tag','parameter_panel_wavelengthunit_edit',...
    'Style','edit',...
    'Parent',p2p9,...
    'BackgroundColor',noneditableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110+(mainPanelWidth-120)/3*2 70 (mainPanelWidth-120)/3 25],...
    'String','nm'...
    );
uicontrol('Tag','parameter_panel_repetitionrate_text',...
    'Style','text',...
    'Parent',p2p9,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 40 90 20],...
    'String','Rep. rate '...
    );
uicontrol('Tag','parameter_panel_repetitionrate_edit',...
    'Style','edit',...
    'Parent',p2p9,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110 40 (mainPanelWidth-120)/3*2 25],...
    'String','0',...
    'Callback',{@parameter_edit_Callback,'laserrepetitionrate'}...
    );
uicontrol('Tag','parameter_panel_repetitionrateunit_edit',...
    'Style','edit',...
    'Parent',p2p9,...
    'BackgroundColor',noneditableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110+(mainPanelWidth-120)/3*2 40 (mainPanelWidth-120)/3 25],...
    'String','Hz'...
    );
uicontrol('Tag','parameter_panel_laserpower_text',...
    'Style','text',...
    'Parent',p2p9,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'Units','Pixels',...
    'Position',[10 10 90 20],...
    'String','Power '...
    );
uicontrol('Tag','parameter_panel_laserpower_edit',...
    'Style','edit',...
    'Parent',p2p9,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110 10 (mainPanelWidth-120)/3*2 25],...
    'String','0',...
    'Callback',{@parameter_edit_Callback,'laserpower'}...
    );
uicontrol('Tag','parameter_panel_laserpowerunit_edit',...
    'Style','edit',...
    'Parent',p2p9,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[110+(mainPanelWidth-120)/3*2 10 (mainPanelWidth-120)/3 25],...
    'String','mJ',...
    'Callback',{@parameter_edit_Callback,'laserpowerunit'}...
    );


% Controls for p3
p3p1 = uipanel('Tag','display_display_panel',...
    'Parent',p3,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'FontWeight','bold',...
    'Units','Pixels',...
    'Position',[10 10 mainPanelWidth 590],...
    'Title','Display'...
    );
p3p1p1 = uipanel('Tag','display_panel_position_panel',...
    'Parent',p3p1,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 mainPanelHeight-140 mainPanelWidth-20 110],...
    'Title','Position'...
    );
uicontrol('Tag','display_panel_position_index_text',...
    'Style','text',...
    'Parent',p3p1p1,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60 60 (mainPanelWidth-90)/2 25],...
    'String','index'...
    );
uicontrol('Tag','display_panel_position_unit_text',...
    'Style','text',...
    'Parent',p3p1p1,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60+(mainPanelWidth-90)/2 60 (mainPanelWidth-90)/2 25],...
    'String','unit'...
    );
uicontrol('Tag','display_panel_position_x_text',...
    'Style','text',...
    'Parent',p3p1p1,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 40 35 20],...
    'String','x'...
    );
uicontrol('Tag','display_panel_position_x_index_edit',...
    'Style','edit',...
    'Parent',p3p1p1,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60 40 (mainPanelWidth-90)/2 25],...
    'String','0',...
    'Callback',{@display_edit_Callback,'positionxindex'}...
    );
uicontrol('Tag','display_panel_position_x_unit_edit',...
    'Style','edit',...
    'Parent',p3p1p1,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60+(mainPanelWidth-90)/2 40 (mainPanelWidth-90)/2 25],...
    'String','0',...
    'Callback',{@display_edit_Callback,'positionxunit'}...
    );
uicontrol('Tag','display_panel_position_y_text',...
    'Style','text',...
    'Parent',p3p1p1,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 10 35 20],...
    'String','y'...
    );
uicontrol('Tag','display_panel_position_y_index_edit',...
    'Style','edit',...
    'Parent',p3p1p1,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60 10 (mainPanelWidth-90)/2 25],...
    'String','0',...
    'Callback',{@display_edit_Callback,'positionyindex'}...
    );
uicontrol('Tag','display_panel_position_y_unit_edit',...
    'Style','edit',...
    'Parent',p3p1p1,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60+(mainPanelWidth-90)/2 10 (mainPanelWidth-90)/2 25],...
    'String','0',...
    'Callback',{@display_edit_Callback,'positionyunit'}...
    );

p3p1p2 = uipanel('Tag','display_panel_scaling_panel',...
    'Parent',p3p1,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 mainPanelHeight-290 mainPanelWidth-20 140],...
    'Title','Scaling'...
    );
uicontrol('Tag','display_panel_scaling_index_text',...
    'Style','text',...
    'Parent',p3p1p2,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60 90 (mainPanelWidth-90)/2 25],...
    'String','factor'...
    );
uicontrol('Tag','display_panel_scaling_unit_text',...
    'Style','text',...
    'Parent',p3p1p2,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60+(mainPanelWidth-90)/2 90 (mainPanelWidth-90)/2 25],...
    'String','Delta in units',...
    'TooltipString','Difference to unscaled in units' ...
    );
uicontrol('Tag','display_panel_scaling_x_text',...
    'Style','text',...
    'Parent',p3p1p2,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 70 35 20],...
    'String','x'...
    );
uicontrol('Tag','display_panel_scaling_x_index_edit',...
    'Style','edit',...
    'Parent',p3p1p2,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60 70 (mainPanelWidth-90)/2 25],...
    'String','0',...
    'Callback',{@display_edit_Callback,'scalingxindex'}...
    );
uicontrol('Tag','display_panel_scaling_x_unit_edit',...
    'Style','edit',...
    'Parent',p3p1p2,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60+(mainPanelWidth-90)/2 70 (mainPanelWidth-90)/2 25],...
    'String','0',...
    'Callback',{@display_edit_Callback,'scalingxunit'}...
    );
uicontrol('Tag','display_panel_scaling_y_text',...
    'Style','text',...
    'Parent',p3p1p2,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 40 35 20],...
    'String','y'...
    );
uicontrol('Tag','display_panel_scaling_y_index_edit',...
    'Style','edit',...
    'Parent',p3p1p2,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60 40 (mainPanelWidth-90)/2 25],...
    'String','0',...
    'Callback',{@display_edit_Callback,'scalingyindex'}...
    );
uicontrol('Tag','display_panel_scaling_y_unit_edit',...
    'Style','edit',...
    'Parent',p3p1p2,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60+(mainPanelWidth-90)/2 40 (mainPanelWidth-90)/2 25],...
    'String','0',...
    'Callback',{@display_edit_Callback,'scalingyunit'}...
    );
uicontrol('Tag','display_panel_scaling_z_text',...
    'Style','text',...
    'Parent',p3p1p2,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 10 35 20],...
    'String','z'...
    );
uicontrol('Tag','display_panel_scaling_z_index_edit',...
    'Style','edit',...
    'Parent',p3p1p2,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60 10 (mainPanelWidth-90)/2 25],...
    'String','0',...
    'Callback',{@display_edit_Callback,'scalingzindex'}...
    );
uicontrol('Tag','display_panel_scaling_z_unit_edit',...
    'Style','edit',...
    'Parent',p3p1p2,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60+(mainPanelWidth-90)/2 10 (mainPanelWidth-90)/2 25],...
    'String','0',...
    'Callback',{@display_edit_Callback,'scalingzunit'}...
    );

p3p1p3 = uipanel('Tag','display_panel_displacement_panel',...
    'Parent',p3p1,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 mainPanelHeight-440 mainPanelWidth-20 140],...
    'Title','Displacement'...
    );
uicontrol('Tag','display_panel_displacement_index_text',...
    'Style','text',...
    'Parent',p3p1p3,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60 90 (mainPanelWidth-90)/2 25],...
    'String','index'...
    );
uicontrol('Tag','display_panel_displacement_unit_text',...
    'Style','text',...
    'Parent',p3p1p3,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60+(mainPanelWidth-90)/2 90 (mainPanelWidth-90)/2 25],...
    'String','unit'...
    );
uicontrol('Tag','display_panel_displacement_x_text',...
    'Style','text',...
    'Parent',p3p1p3,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 70 35 20],...
    'String','x'...
    );
uicontrol('Tag','display_panel_displacement_x_index_edit',...
    'Style','edit',...
    'Parent',p3p1p3,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60 70 (mainPanelWidth-90)/2 25],...
    'String','0',...
    'Callback',{@display_edit_Callback,'displacementxindex'}...
    );
uicontrol('Tag','display_panel_displacement_x_unit_edit',...
    'Style','edit',...
    'Parent',p3p1p3,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60+(mainPanelWidth-90)/2 70 (mainPanelWidth-90)/2 25],...
    'String','0',...
    'Callback',{@display_edit_Callback,'displacementxunit'}...
    );
uicontrol('Tag','display_panel_displacement_y_text',...
    'Style','text',...
    'Parent',p3p1p3,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 40 35 20],...
    'String','y'...
    );
uicontrol('Tag','display_panel_displacement_y_index_edit',...
    'Style','edit',...
    'Parent',p3p1p3,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60 40 (mainPanelWidth-90)/2 25],...
    'String','0',...
    'Callback',{@display_edit_Callback,'displacementyindex'}...
    );
uicontrol('Tag','display_panel_displacement_y_unit_edit',...
    'Style','edit',...
    'Parent',p3p1p3,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60+(mainPanelWidth-90)/2 40 (mainPanelWidth-90)/2 25],...
    'String','0',...
    'Callback',{@display_edit_Callback,'displacementyunit'}...
    );
uicontrol('Tag','display_panel_displacement_z_text',...
    'Style','text',...
    'Parent',p3p1p3,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 10 35 20],...
    'String','z'...
    );
uicontrol('Tag','display_panel_displacement_z_index_edit',...
    'Style','edit',...
    'Parent',p3p1p3,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60 10 (mainPanelWidth-90)/2 25],...
    'String','0',...
    'Callback',{@display_edit_Callback,'displacementzindex'}...
    );
uicontrol('Tag','display_panel_displacement_z_unit_edit',...
    'Style','edit',...
    'Parent',p3p1p3,...
    'BackgroundColor',editableBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60+(mainPanelWidth-90)/2 10 (mainPanelWidth-90)/2 25],...
    'String','0',...
    'Callback',{@display_edit_Callback,'displacementzunit'}...
    );

p3p1p4 = uipanel('Tag','display_panel_average_panel',...
    'Parent',p3p1,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 mainPanelHeight-590 mainPanelWidth-20 140],...
    'Title','Smoothing (running average filter)'...
    );
uicontrol('Tag','display_panel_average_type_text',...
    'Style','text',...
    'Parent',p3p1p4,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 90 35 20],...
    'String','type'...
    );
uicontrol('Tag','display_panel_average_type_popupmenu',...
    'Style','popupmenu',...
    'Parent',p3p1p4,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[55 95 mainPanelWidth-80 20],...
    'String','simple_filter'...
    );
uicontrol('Tag','display_panel_average_points_text',...
    'Style','text',...
    'Parent',p3p1p4,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60 60 (mainPanelWidth-90)/2 25],...
    'String','points'...
    );
uicontrol('Tag','display_panel_average_unit_text',...
    'Style','text',...
    'Parent',p3p1p4,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60+(mainPanelWidth-90)/2 60 (mainPanelWidth-90)/2 25],...
    'String','unit'...
    );
uicontrol('Tag','display_panel_average_x_text',...
    'Style','text',...
    'Parent',p3p1p4,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 40 35 20],...
    'String','x'...
    );
uicontrol('Tag','display_panel_average_x_points_edit',...
    'Style','edit',...
    'Parent',p3p1p4,...
    'BackgroundColor',[1 1 1],...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60 40 (mainPanelWidth-90)/2 25],...
    'String','1',...
    'Callback',{@display_edit_Callback,'averagexindex'}...
    );
uicontrol('Tag','display_panel_average_x_unit_edit',...
    'Style','edit',...
    'Parent',p3p1p4,...
    'BackgroundColor',[1 1 1],...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60+(mainPanelWidth-90)/2 40 (mainPanelWidth-90)/2 25],...
    'String','0',...
    'Callback',{@display_edit_Callback,'averagexunit'}...
    );
uicontrol('Tag','display_panel_average_y_text',...
    'Style','text',...
    'Parent',p3p1p4,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 10 35 20],...
    'String','y'...
    );
uicontrol('Tag','display_panel_average_y_points_edit',...
    'Style','edit',...
    'Parent',p3p1p4,...
    'BackgroundColor',[1 1 1],...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60 10 (mainPanelWidth-90)/2 25],...
    'String','1',...
    'Callback',{@display_edit_Callback,'averageyindex'}...
    );
uicontrol('Tag','display_panel_average_y_unit_edit',...
    'Style','edit',...
    'Parent',p3p1p4,...
    'BackgroundColor',[1 1 1],...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60+(mainPanelWidth-90)/2 10 (mainPanelWidth-90)/2 25],...
    'String','0',...
    'Callback',{@display_edit_Callback,'averageyunit'}...
    );

p3p2 = uipanel('Tag','display_panel_axis_panel',...
    'Parent',p3,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'FontWeight','bold',...
    'Units','Pixels',...
    'Position',[mainPanelWidth+20 280 mainPanelWidth 320],...
    'Title','Axes'...
    );
p3p2p6 = uipanel('Tag','display_panel_axislabels_panel',...
    'Parent',p3p2,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 160 mainPanelWidth-20 140],...
    'Title','Axis labels'...
    );
uicontrol('Tag','display_panel_axislabels_measure_text',...
    'Style','text',...
    'Parent',p3p2p6,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60 90 (mainPanelWidth-90)/2 25],...
    'String','Measure'...
    );
uicontrol('Tag','display_panel_axislabels_unit_text',...
    'Style','text',...
    'Parent',p3p2p6,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60+(mainPanelWidth-90)/2 90 (mainPanelWidth-90)/2 25],...
    'String','Unit'...
    );
uicontrol('Tag','display_panel_axislabels_x_text',...
    'Style','text',...
    'Parent',p3p2p6,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 70 35 20],...
    'String','x'...
    );
uicontrol('Tag','display_panel_axislabels_x_measure_edit',...
    'Style','edit',...
    'Parent',p3p2p6,...
    'BackgroundColor',[1 1 1],...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60 70 (mainPanelWidth-90)/3*2 25],...
    'String','index',...
    'Callback',{@axislabels_edit_Callback,'xmeasure'}...
    );
uicontrol('Tag','display_panel_axislabels_x_unit_edit',...
    'Style','edit',...
    'Parent',p3p2p6,...
    'BackgroundColor',[1 1 1],...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60+(mainPanelWidth-90)/3*2 70 (mainPanelWidth-90)/3 25],...
    'String','points',...
    'Callback',{@axislabels_edit_Callback,'xunit'}...
    );
uicontrol('Tag','display_panel_axislabels_y_text',...
    'Style','text',...
    'Parent',p3p2p6,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 40 35 20],...
    'String','y'...
    );
uicontrol('Tag','display_panel_axislabels_y_measure_edit',...
    'Style','edit',...
    'Parent',p3p2p6,...
    'BackgroundColor',[1 1 1],...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60 40 (mainPanelWidth-90)/3*2 25],...
    'String','index',...
    'Callback',{@axislabels_edit_Callback,'ymeasure'}...
    );
uicontrol('Tag','display_panel_axislabels_y_unit_edit',...
    'Style','edit',...
    'Parent',p3p2p6,...
    'BackgroundColor',[1 1 1],...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60+(mainPanelWidth-90)/3*2 40 (mainPanelWidth-90)/3 25],...
    'String','points',...
    'Callback',{@axislabels_edit_Callback,'yunit'}...
    );
uicontrol('Tag','display_panel_axislabels_z_text',...
    'Style','text',...
    'Parent',p3p2p6,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 10 35 20],...
    'String','z'...
    );
uicontrol('Tag','display_panel_axislabels_z_measure_edit',...
    'Style','edit',...
    'Parent',p3p2p6,...
    'BackgroundColor',[1 1 1],...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60 10 (mainPanelWidth-90)/3*2 25],...
    'String','index',...
    'Callback',{@axislabels_edit_Callback,'zmeasure'}...
    );
uicontrol('Tag','display_panel_axislabels_z_unit_edit',...
    'Style','edit',...
    'Parent',p3p2p6,...
    'BackgroundColor',[1 1 1],...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60+(mainPanelWidth-90)/3*2 10 (mainPanelWidth-90)/3 25],...
    'String','points',...
    'Callback',{@axislabels_edit_Callback,'zunit'}...
    );

p3p2p6 = uipanel('Tag','display_panel_axislimits_panel',...
    'Parent',p3p2,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 10 mainPanelWidth-20 140],...
    'Title','Axis limits'...
    );
uicontrol('Tag','display_panel_axislimits_min_text',...
    'Style','text',...
    'Parent',p3p2p6,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60 90 (mainPanelWidth-90)/2 25],...
    'String','min'...
    );
uicontrol('Tag','display_panel_axislimits_max_text',...
    'Style','text',...
    'Parent',p3p2p6,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60+(mainPanelWidth-90)/2 90 (mainPanelWidth-90)/2 25],...
    'String','max'...
    );
uicontrol('Tag','display_panel_axislimits_x_text',...
    'Style','text',...
    'Parent',p3p2p6,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 70 35 20],...
    'String','x'...
    );
uicontrol('Tag','display_panel_axislimits_x_min_edit',...
    'Style','edit',...
    'Parent',p3p2p6,...
    'BackgroundColor',editableWarningBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60 70 (mainPanelWidth-90)/2 25],...
    'String','0',...
    'Callback',{@axislimits_edit_Callback,'xmin'}...
    );
uicontrol('Tag','display_panel_axislimits_x_max_edit',...
    'Style','edit',...
    'Parent',p3p2p6,...
    'BackgroundColor',editableWarningBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60+(mainPanelWidth-90)/2 70 (mainPanelWidth-90)/2 25],...
    'String','1',...
    'Callback',{@axislimits_edit_Callback,'xmax'}...
    );
uicontrol('Tag','display_panel_axislimits_y_text',...
    'Style','text',...
    'Parent',p3p2p6,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 40 35 20],...
    'String','y'...
    );
uicontrol('Tag','display_panel_axislimits_y_min_edit',...
    'Style','edit',...
    'Parent',p3p2p6,...
    'BackgroundColor',editableWarningBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60 40 (mainPanelWidth-90)/2 25],...
    'String','0',...
    'Callback',{@axislimits_edit_Callback,'ymin'}...
    );
uicontrol('Tag','display_panel_axislimits_y_max_edit',...
    'Style','edit',...
    'Parent',p3p2p6,...
    'BackgroundColor',editableWarningBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60+(mainPanelWidth-90)/2 40 (mainPanelWidth-90)/2 25],...
    'String','1',...
    'Callback',{@axislimits_edit_Callback,'ymax'}...
    );
uicontrol('Tag','display_panel_axislimits_z_text',...
    'Style','text',...
    'Parent',p3p2p6,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 10 35 20],...
    'String','z'...
    );
uicontrol('Tag','display_panel_axislimits_z_min_edit',...
    'Style','edit',...
    'Parent',p3p2p6,...
    'BackgroundColor',editableWarningBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60 10 (mainPanelWidth-90)/2 25],...
    'String','-1',...
    'Callback',{@axislimits_edit_Callback,'zmin'}...
    );
uicontrol('Tag','display_panel_axislimits_z_max_edit',...
    'Style','edit',...
    'Parent',p3p2p6,...
    'BackgroundColor',editableWarningBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60+(mainPanelWidth-90)/2 10 (mainPanelWidth-90)/2 25],...
    'String','1',...
    'Callback',{@axislimits_edit_Callback,'zmax'}...
    );


p3p3 = uipanel('Tag','display_panel_linestyle_panel',...
    'Parent',p3,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'FontWeight','bold',...
    'Units','Pixels',...
    'Position',[mainPanelWidth+20 10 mainPanelWidth 260],...
    'Title','Line'...
    );
p3p3p1 = uipanel('Tag','display_panel_colour_panel',...
    'Parent',p3p3,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 140 mainPanelWidth-20 100],...
    'Title','Colour'...
    );
uicontrol('Tag','display_panel_colour_type_text',...
    'Style','text',...
    'Parent',p3p3p1,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 50 40 20],...
    'String','Type'...
    );
uicontrol('Tag','display_panel_colour_type_popupmenu',...
    'Style','popupmenu',...
    'Parent',p3p3p1,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60 50 (mainPanelWidth-90)/2 20],...
    'String','name|RGB',...
    'Callback',{@colour_type_popupmenu_Callback}...
    );
uicontrol('Tag','display_panel_colour_type2_popupmenu',...
    'Style','popupmenu',...
    'Parent',p3p3p1,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60+((mainPanelWidth-90)/2) 50 (mainPanelWidth-90)/2 20],...
    'String','b|g|r|c|m|y|k',...
    'Callback',{@colour_type2_popupmenu_Callback}...
    );
uicontrol('Tag','display_panel_colour_type_text',...
    'Style','text',...
    'Parent',p3p3p1,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 10 40 20],...
    'String','RGB'...
    );
uicontrol('Tag','display_panel_colour_r_edit',...
    'Style','edit',...
    'Parent',p3p3p1,...
    'BackgroundColor',[1 1 1],...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60 10 (mainPanelWidth-90)/3 25],...
    'String','1',...
    'Enable','Off',...
    'Callback',{@display_edit_Callback,'colourr'}...
    );
uicontrol('Tag','display_panel_colour_g_edit',...
    'Style','edit',...
    'Parent',p3p3p1,...
    'BackgroundColor',[1 1 1],...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60+(mainPanelWidth-90)/3 10 (mainPanelWidth-90)/3 25],...
    'String','0',...
    'Enable','Off',...
    'Callback',{@display_edit_Callback,'colourg'}...
    );
uicontrol('Tag','display_panel_colour_b_edit',...
    'Style','edit',...
    'Parent',p3p3p1,...
    'BackgroundColor',[1 1 1],...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[60+(mainPanelWidth-90)/3*2 10 (mainPanelWidth-90)/3 25],...
    'String','0',...
    'Enable','Off',...
    'Callback',{@display_edit_Callback,'colourb'}...
    );

p3p3p2 = uipanel('Tag','display_panel_line_panel',...
    'Parent',p3p3,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 10 mainPanelWidth-20 120],...
    'Title','Line settings'...
    );
uicontrol('Tag','display_panel_linewidth_text',...
    'Style','text',...
    'Parent',p3p3p2,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 70 60 20],...
    'String','Width'...
    );
uicontrol('Tag','display_panel_linewidth_popupmenu',...
    'Style','popupmenu',...
    'Parent',p3p3p2,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[80 70 mainPanelWidth-105 20],...
    'String','1 px|2 px|3 px|4 px|5 px',...
    'Callback',{@linewidth_popupmenu_Callback}...
    );
uicontrol('Tag','display_panel_linestyle_text',...
    'Style','text',...
    'Parent',p3p3p2,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 40 60 20],...
    'String','Style'...
    );
uicontrol('Tag','display_panel_linestyle_popupmenu',...
    'Style','popupmenu',...
    'Parent',p3p3p2,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[80 40 mainPanelWidth-105 20],...
    'String','solid|dashed|dotted|dash-dotted',...
    'Callback',{@linestyle_popupmenu_Callback}...
    );
uicontrol('Tag','display_panel_linemmarker_text',...
    'Style','text',...
    'Parent',p3p3p2,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 10 60 20],...
    'String','Marker'...
    );
uicontrol('Tag','display_panel_linemarker_popupmenu',...
    'Style','popupmenu',...
    'Parent',p3p3p2,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[80 10 mainPanelWidth-105 20],...
    'String',['none|plus|circle|asterisk|point|cross|square|diamond|'...
    'triangle up|triangle down|triangle right|triangle left|'...
    'pentagram|hexagram'],...
    'Callback',{@linemarker_popupmenu_Callback}...
    );


% Controls for p4
p4p1 = uipanel('Tag','history_panel_records_panel',...
    'parent',p4,...
    'Title','History record',...
    'FontUnit','Pixel','Fontsize',12,...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'Position',[10 500 mainPanelWidth 100]);
uicontrol('Tag','history_panel_records_listbox',...
    'Style','listbox',...
    'Parent',p4p1,...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'Units','Pixels',...
    'Position',[10 10 panel_size 70],...
    'String','',...
    'Callback',{@history_listbox_Callback}...
    );

p4p2 = uipanel('Tag','history_panel_summary_panel',...
    'parent',p4,...
    'Title','Summary',...
    'FontUnit','Pixel','Fontsize',12,...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'Position',[10+mainPanelWidth+10 500 mainPanelWidth 100]);
uicontrol('Tag','history_panel_datelabel_text',...
    'Style','text',...
    'parent',p4p2,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'String','Date: ',...
    'Position',[10 50 70 20]);
uicontrol('Tag','history_panel_date_text',...
    'Style','text',...
    'parent',p4p2,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Left',...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'String','xxxx-xx-xx ##:##:##',...
    'Position',[85 50 panel_size-75 20]);
uicontrol('Tag','history_panel_methodlabel_text',...
    'Style','text',...
    'parent',p4p2,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'String','Method: ',...
    'Position',[10 30 70 20]);
uicontrol('Tag','history_panel_method_text',...
    'Style','text',...
    'parent',p4p2,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Left',...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'String','Some method name',...
    'Position',[85 30 panel_size-75 20]);
uicontrol('Tag','history_panel_operatorlabel_text',...
    'Style','text',...
    'parent',p4p2,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'String','Operator: ',...
    'Position',[10 10 70 20]);
uicontrol('Tag','history_panel_operator_text',...
    'Style','text',...
    'parent',p4p2,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Left',...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'String','Some operator name',...
    'Position',[85 10 panel_size-75 20]);

p4p3 = uipanel('Tag','history_panel_system_panel',...
    'parent',p4,...
    'Title','System',...
    'FontUnit','Pixel','Fontsize',12,...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'Position',[10 390 mainPanelWidth*2+10 100]);
uicontrol('Tag','history_panel_platformlabel_text',...
    'Style','text',...
    'parent',p4p3,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'String','Platform: ',...
    'Position',[10 50 115 20]);
uicontrol('Tag','history_panel_platform_text',...
    'Style','text',...
    'parent',p4p3,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Left',...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'String',platform,...
    'Position',[130 50 (mainPanelWidth*2)-130 20]);
uicontrol('Tag','history_panel_matlabversionlabel_text',...
    'Style','text',...
    'parent',p4p3,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'String','Matlab version: ',...
    'Position',[10 30 115 20]);
uicontrol('Tag','history_panel_matlabversion_text',...
    'Style','text',...
    'parent',p4p3,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Left',...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'String',version,...
    'Position',[130 30 (mainPanelWidth*2)-130 20]);
uicontrol('Tag','history_panel_toolboxversionlabel_text',...
    'Style','text',...
    'parent',p4p3,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Right',...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'String','Toolbox version: ',...
    'Position',[10 10 115 20]);
uicontrol('Tag','history_panel_toolboxversion_text',...
    'Style','text',...
    'parent',p4p3,...
    'FontUnit','Pixel','Fontsize',12,...
    'HorizontalAlignment','Left',...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'String','Toolbox version string',...
    'Position',[130 10 (mainPanelWidth*2)-130 20]);

p4p4 = uipanel('Tag','history_panel_display_panel',...
    'parent',p4,...
    'Title','Parameters',...
    'FontUnit','Pixel','Fontsize',12,...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'Position',[10 200 mainPanelWidth*2+10 180]);
uicontrol('Tag','history_panel_parameter_edit',...
    'Style','edit',...
    'parent',p4p4,...
    'FontUnit','Pixel','Fontsize',12,...
    'FontName','FixedWidth',...
    'HorizontalAlignment','Left',...
    'BackgroundColor',noneditableBackground,...
    'Max',2,'Min',0,...
    'Visible','on',...
    'Units','pixels',...
    'String','No parameters to display currently',...
    'Position',[10 10 mainPanelWidth*2-10 150]);

p4p5 = uipanel('Tag','history_panel_report_panel',...
    'parent',p4,...
    'Title','Report',...
    'FontUnit','Pixel','Fontsize',12,...
    'BackgroundColor',defaultBackground,...
    'Visible','on',...
    'Units','pixels',...
    'Position',[10 10 mainPanelWidth*2+10 180]);
uicontrol('Tag','history_panel_report_edit',...
    'Style','edit',...
    'parent',p4p5,...
    'FontUnit','Pixel','Fontsize',12,...
    'FontName','FixedWidth',...
    'HorizontalAlignment','Left',...
    'BackgroundColor',noneditableBackground,...
    'Max',2,'Min',0,...
    'Visible','on',...
    'Units','pixels',...
    'String','No information to display currently',...
    'Position',[10 10 mainPanelWidth*2-10 150]);


%--------------------------------------------
% Create controls for main buttons bottom left
uicontrol('Tag','apply_pushbutton',...
    'Style','pushbutton',...
	'Parent', hMainFigure, ...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'String','Apply',...
    'TooltipString','Apply changes to currently selected dataset',...
    'pos',[guiSize(1)-panel_size-40 20 (panel_size+20)/3 40],...
    'Enable','on',...
    'Callback',{@pushbutton_Callback,'Apply'}...
    );
uicontrol('Tag','discard_pushbutton',...
    'Style','pushbutton',...
	'Parent', hMainFigure, ...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'String','Revert',...
    'TooltipString',sprintf('%s\n%s',...
    'Discard changes for current dataset',...
    'and revert to original settings.'),...
    'pos',[guiSize(1)-((panel_size+20)/3*2)-20 20 (panel_size+20)/3 40],...
    'Enable','on',...
    'Callback',{@pushbutton_Callback,'Revert'}...
    );
uicontrol('Tag','close_pushbutton',...
    'Style','pushbutton',...
	'Parent', hMainFigure, ...
    'BackgroundColor',defaultBackground,...
    'FontUnit','Pixel','Fontsize',12,...
    'String','Close',...
    'TooltipString','Close Info Window',...
    'pos',[guiSize(1)-((panel_size+20)/3)-20 20 (panel_size+20)/3 40],...
    'Enable','on',...
    'Callback',{@pushbutton_Callback,'Close'}...
    );


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  Initialization tasks
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Store handles in guidata
guidata(hMainFigure,guihandles);

% Create appdata structure
ad = guiDataStructure('guiappdatastructure');

setappdata(hMainFigure,'data',ad.data);
setappdata(hMainFigure,'origdata',ad.origdata);
setappdata(hMainFigure,'configuration',ad.configuration);
setappdata(hMainFigure,'control',ad.control);

% Load data from Main GUI
mainGuiWindow = guiGetWindowHandle();
if (mainGuiWindow)
    admain = getappdata(mainGuiWindow);
    % Check for availability of necessary fields in appdata
    if (isfield(admain,'data') ~= 0)
        ad.data = admain.data;
        setappdata(hMainFigure,'data',ad.data);
        ad.origdata = admain.data;
        setappdata(hMainFigure,'origdata',ad.origdata);
    end
    if (isfield(admain,'control') ~= 0)
        ad.control = admain.control;
        % Move (in)visible -> loaded
        ad.control.spectra.loaded = [ ...
            admain.control.spectra.visible ...
        	admain.control.spectra.invisible ...
            ];
        ad.control.spectra = rmfield(ad.control.spectra,'visible');
        ad.control.spectra = rmfield(ad.control.spectra,'invisible');
        % Set history record cell array to default value
        for k=1:length(ad.control.spectra.loaded)
            ad.control.spectra.history{k} = 0;
        end
        if isempty(ad.control.spectra.active) || ...
                (ad.control.spectra.active == 0)
            ad.control.spectra.active = 1;
        end
        % Set modified to empty array - as at the beginning, no dataset has
        % been modified in terms of its information
        ad.control.spectra.modified = [];
        % Add additional field "unsaved" for datasets that have been
        % changed but not saved (hit "Apply") yet - "saved" means here only
        % within the info GUI window. The final transfer to the main GUI
        % window is done when the info GUI is closed.
        ad.control.spectra.unsaved = [];
        setappdata(hMainFigure,'control',ad.control);
    end
    
    updateDatasets();
    updateGeneralPanel();
    updateParameterPanel();
    updateDisplayPanel();
    updateHistoryPanel();
end

switchPanel('General');

% Make the GUI visible.
set(hMainFigure,'Visible','on');
msgStr = 'Info GUI window opened';
add2status(msgStr);

if (nargout == 1)
    varargout{1} = hMainFigure;
end

% Add keypress function to every element that can have one...
handles = findall(...
    allchild(hMainFigure),'style','pushbutton',...
    '-or','style','togglebutton',...
    '-or','style','edit',...
    '-or','style','listbox',...
    '-or','style','popupmenu');
for k=1:length(handles)
    set(handles(k),'KeyPressFcn',@keypress_Callback);
end

% Temporary "fix": Disable all elements of the "Display settings" panel
displayPanelHandles = findall(...
    allchild(p3),'style','edit',...
    '-or','style','popupmenu');
for k=1:length(displayPanelHandles)
    set(displayPanelHandles(k),'Enable','inactive');
end

% Get all edit fields that are marked as "Handle carefully"
warningBackgroundEditFields = findall(...
    allchild(hMainFigure),'BackgroundColor',editableWarningBackground);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  Callbacks
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


function tbg_Callback(source,~)
    try 
        switchPanel(get(get(source,'SelectedObject'),'String'));
    catch exception
        try
            msgStr = ['An exception occurred. '...
                'The bug reporter should have been opened'];
            add2status(msgStr);
        catch exception2
            exception = addCause(exception2, exception);
            disp(msgStr);
        end
        try
            trEPRgui_bugreportwindow(exception);
        catch exception3
            % If even displaying the bug report window fails...
            exception = addCause(exception3, exception);
            throw(exception);
        end
    end
end

function ptbg_Callback(source,~)
    try 
        switchParameterPanel(get(get(source,'SelectedObject'),'String'));
    catch exception
        try
            msgStr = ['An exception occurred. '...
                'The bug reporter should have been opened'];
            add2status(msgStr);
        catch exception2
            exception = addCause(exception2, exception);
            disp(msgStr);
        end
        try
            trEPRgui_bugreportwindow(exception);
        catch exception3
            % If even displaying the bug report window fails...
            exception = addCause(exception3, exception);
            throw(exception);
        end
    end
end

function dataset_listbox_Callback(source,~)
    try
        % Get appdata of main window
        mainWindow = guiGetWindowHandle(mfilename);
        ad = getappdata(mainWindow);
        
        ad.control.spectra.active = ad.control.spectra.loaded(...
            get(source,'Value')...
            );
        
        % Update appdata of main window
        setappdata(mainWindow,'control',ad.control);
        
        % Update panels
        updateGeneralPanel();
        updateParameterPanel();
        updateDisplayPanel();
        updateHistoryPanel();
    catch exception
        try
            msgStr = ['An exception occurred. '...
                'The bug reporter should have been opened'];
            add2status(msgStr);
        catch exception2
            exception = addCause(exception2, exception);
            disp(msgStr);
        end
        try
            trEPRgui_bugreportwindow(exception);
        catch exception3
            % If even displaying the bug report window fails...
            exception = addCause(exception3, exception);
            throw(exception);
        end
    end
end

function general_edit_Callback(source,~,value)
    try
        % If value is empty, restore previous entry and return
        if isempty(get(source,'String'))
            % Update general panel
            updateGeneralPanel();
            return;
        end
        
        % Get appdata from main window
        mainWindow = guiGetWindowHandle(mfilename);
        ad = getappdata(mainWindow);
        
        switch value
            case 'label'
                oldValue = ad.data{ad.control.spectra.active}.label;
                if ~strcmp(oldValue,get(source,'String'))
                    ad.data{ad.control.spectra.active}.label = ...
                        get(source,'String');
                    % If current active spectrum is not labeled "modified", do so
                    if isempty(find(ad.control.spectra.modified==ad.control.spectra.active,1))
                        ad.control.spectra.modified(end+1) = ...
                            ad.control.spectra.active;
                    end
                    % If current active spectrum is not labeled "unsaved", do so
                    if isempty(find(ad.control.spectra.unsaved==ad.control.spectra.active,1))
                        ad.control.spectra.unsaved(end+1) = ...
                            ad.control.spectra.active;
                    end
                end
            otherwise
                % fallback
                disp(['Unknown field: ' value]);
                return;
        end
        
        % Update appdata of main window
        setappdata(mainWindow,'data',ad.data);
        setappdata(mainWindow,'control',ad.control);
        
        % Update parameter panel
        updateGeneralPanel();
        
        % Update dataset list
        updateDatasets();
    catch exception
        try
            msgStr = ['An exception occurred. '...
                'The bug reporter should have been opened'];
            add2status(msgStr);
        catch exception2
            exception = addCause(exception2, exception);
            disp(msgStr);
        end
        try
            trEPRgui_bugreportwindow(exception);
        catch exception3
            % If even displaying the bug report window fails...
            exception = addCause(exception3, exception);
            throw(exception);
        end
    end
end     

function parameter_edit_Callback(source,~,value)
    try
        mainWindow = guiGetWindowHandle(mfilename);
        % Get appdata from info GUI
        ad = getappdata(mainWindow);

        if isempty(ad.data)
            return;
        end
        
        % Get handles from info GUI
        gh = guidata(mainWindow);
        
        % Cell array matching values to data structure
        % The first column contains the value (third input parameter).
        % The second column contains the corresponding field in the
        % parameters part of the data structure.
        % The third column contains the name of a function to apply to the
        % value read from the edit field. Leave empty if none to apply.
        % The fourth column contains an index, in case that the field in
        % the data structure is a vector and a certain field of that is
        % needed.        
        matching = {...
            'samplename','sample.name','',''; ...
            'sampletube','sample.tube','',''; ...
            'sampledescription','sample.description','',''; ...
            'samplepreparation','sample.preparation','',''; ...
            'date','parameters.date','',''; ...
            'operator','parameters.operator','',''; ...
            'nruns','parameters.runs','str2double',''; ...
            'temperature','parameters.temperature.value','str2double',''; ...
            'temperatureunit','parameters.temperature.unit','',''; ...
            'xmeasure','axes.x.measure','',''; ...
            'xunit','axes.x.unit','',''; ...
            'ymeasure','axes.y.measure','',''; ...
            'yunit','axes.y.unit','',''; ...
            'zmeasure','axes.z.measure','',''; ...
            'zunit','axes.z.unit','',''; ...
            'fieldstart','parameters.field.start','str2double',''; ...
            'fieldstartunit','parameters.field.unit','',''; ...
            'fieldend','parameters.field.stop','str2double',''; ...
            'fieldendunit','parameters.field.unit','',''; ...
            'fieldstep','parameters.field.step','str2double',''; ...
            'fieldstepunit','parameters.field.unit','',''; ...
            'fieldcontroller','parameters.field.model','',''; ...
            'fieldstartcalibrated','parameters.field.calibration.values','str2double',1; ...
            'fieldstartcalibratedunit','parameters.field.calibration.unit','',''; ...
            'fieldendcalibrated','parameters.field.calibration.values','str2double',2; ...
            'fieldendcalibratedunit','parameters.field.calibration.unit','',''; ...
            'fieldcalibratedprobe','parameters.field.calibration.model','',''; ...
            'triggerposition','parameters.transient.triggerPosition','str2double',''; ...
            'transientlength','parameters.transient.length','str2double',''; ...
            'transientlengthunit','parameters.transient.unit','',''; ...
            'probehead','parameters.bridge.probehead','',''; ...
            'bridgemodel','parameters.bridge.model','',''; ...
            'mwfrequency','parameters.bridge.MWfrequency.value','str2double',''; ...
            'bridgeattenuation','parameters.bridge.attenuation.value','str2double',''; ...
            'mwpower','parameters.bridge.power.value','str2double',''; ...
            'mwpowerunit','parameters.bridge.power.unit','',''; ...
            'bridgebandwidth','parameters.bridge.bandwidth.value','str2double',''; ...
            'bridgebandwidthunit','parameters.bridge.bandwidth.unit','',''; ...
            'videoamplification','parameters.bridge.amplification.value','str2double',''; ...
            'mwcalibratedstart','parameters.bridge.calibration.values','str2double',1; ...
            'mwcalibratedstartunit','parameters.bridge.calibration.unit','',''; ...
            'mwcalibratedend','parameters.bridge.calibration.values','str2double',2; ...
            'mwcalibratedendunit','parameters.bridge.calibration.unit','',''; ...
            'mwcounter','parameters.bridge.calibration.model','',''; ...
            'recordermodel','parameters.recorder.model','',''; ...
            'averages','parameters.recorder.averages','str2double',''; ...
            'recordercoupling','parameters.recorder.coupling','',''; ...
            'recorderimpedance','parameters.recorder.impedance.value','str2double',''; ...
            'recorderimpedanceunit','parameters.recorder.impedance.unit','',''; ...
            'recordertimebase','parameters.recorder.timeBase.value','str2double',''; ...
            'recordertimebaseunit','parameters.recorder.timeBase.unit','',''; ...
            'recorderbandwidth','parameters.recorder.bandwidth.value','str2double',''; ...
            'recorderbandwidthunit','parameters.recorder.bandwidth.unit','',''; ...
            'recordersensitivity','parameters.recorder.sensitivity.value','str2double',''; ...
            'recordersensitivityunit','parameters.recorder.sensitivity.unit','',''; ...
            'lasermodel','parameters.laser.model','',''; ...
            'opodye','','parameters.laser.opodye',''; ...
            'laserwavelength','parameters.laser.wavelength.value','str2double',''; ...
            'laserrepetitionrate','parameters.laser.repetitionRate','str2double',''; ...
            'laserpower','parameters.laser.power.value','str2double',''; ...
            'laserpowerunit','parameters.laser.power.unit','',''; ...
            };
        
        fieldValue = get(source,'String');
                
        % If value is in matching cell array
        [matches,index] = max(strcmp(value,matching(:,1)));
        if matches
            % Check whether there is some function to apply first
            if ~isempty(matching{index,3})
                fun = str2func(matching{index,3});
                fieldValue = fun(fieldValue);
            end
            % Check whether we should get only a particular element
            if ~isempty(matching{index,4})
                fieldValue = fieldValue(matching{index,4});
            end
            oldFieldValue = getCascadedField(...
                ad.data{ad.control.spectra.active},...
                matching{index,2});
            % Workaround in case that oldFieldValue is an empty cell
            if iscell(oldFieldValue) && isempty(oldFieldValue)
                oldFieldValue = '';
            end
            % Only in case that old and new field value are different,
            % update the field in the data structure and set dataset to
            % modified.
            % The test for notempty of both old and new value is due to
            % that an empty edit field will not reply '', but something as
            % "Empty string: 1-by-0" that does not compare to ''.
            if ~strcmp(fieldValue,oldFieldValue) && ...
                    ~strcmp(fieldValue,'N/A') && ...
                    ~strcmp(fieldValue,'yyyy-mm-dd') && ...
                    ~strcmp(fieldValue,'index') && ...
                    ~strcmp(fieldValue,'points') && ...
                    ~(isempty(fieldValue) && isempty(oldFieldValue))
                ad.data{ad.control.spectra.active} = setCascadedField(...
                    ad.data{ad.control.spectra.active},...
                    matching{index,2}, ...
                    fieldValue);
                % If current active spectrum is not labeled "modified", do so
                if isempty(find(ad.control.spectra.modified==ad.control.spectra.active,1))
                    ad.control.spectra.modified(end+1) = ...
                        ad.control.spectra.active;
                end
                % If current active spectrum is not labeled "unsaved", do so
                if isempty(find(ad.control.spectra.unsaved==ad.control.spectra.active,1))
                    ad.control.spectra.unsaved(end+1) = ...
                        ad.control.spectra.active;
                end
            end
            % If value is NaN, change colour of field accordingly
            if isnumeric(fieldValue) && isnan(fieldValue)
                set(source,'BackgroundColor',editableErrorBackground);
            elseif find(warningBackgroundEditFields==source)
                set(source,'BackgroundColor',editableWarningBackground);
            else
                set(source,'BackgroundColor',editableBackground);
            end
        end
        
        % Check for consistency of the values for the magnetic field
        fieldEditFields = [...
            gh.parameter_panel_fieldstart_edit ...
            gh.parameter_panel_fieldend_edit ...
            gh.parameter_panel_fieldstep_edit ...            
            ];
        [y,~] = size(ad.data{ad.control.spectra.active}.data);
        if (length(...
                ad.data{ad.control.spectra.active}.parameters.field.start:...
                ad.data{ad.control.spectra.active}.parameters.field.step:...
                ad.data{ad.control.spectra.active}.parameters.field.stop)~=y)
            for k=1:length(fieldEditFields)
                set(fieldEditFields(k),...
                    'BackgroundColor',editableErrorBackground);
            end
        else
            for k=1:length(fieldEditFields)
                set(fieldEditFields(k),...
                    'BackgroundColor',editableWarningBackground);
            end
            % Set field axis values
            ad.data{ad.control.spectra.active}.axes.y.values = ...
                ad.data{ad.control.spectra.active}.parameters.field.start:...
                ad.data{ad.control.spectra.active}.parameters.field.step:...
                ad.data{ad.control.spectra.active}.parameters.field.stop ;
        end
        
        % Set time axis parameters according to new values
        ad.data{ad.control.spectra.active}.axes.x.values = ...
            -ad.data{ad.control.spectra.active}.parameters.transient.length/...
            ad.data{ad.control.spectra.active}.parameters.transient.points * ...
            (ad.data{ad.control.spectra.active}.parameters.transient.triggerPosition - 1) : ...
            ad.data{ad.control.spectra.active}.parameters.transient.length/...
            ad.data{ad.control.spectra.active}.parameters.transient.points : ...
            ad.data{ad.control.spectra.active}.parameters.transient.length - ...
            ad.data{ad.control.spectra.active}.parameters.transient.length/...
            ad.data{ad.control.spectra.active}.parameters.transient.points * ...
            ad.data{ad.control.spectra.active}.parameters.transient.triggerPosition;
        
        % Update appdata of main window
        setappdata(mainWindow,'data',ad.data);
        setappdata(mainWindow,'control',ad.control);
        
        % Update parameter panel
        updateParameterPanel();
        
        % Update dataset display
        updateDatasets();
    catch exception
        try
            msgStr = ['An exception occurred. '...
                'The bug reporter should have been opened'];
            add2status(msgStr);
        catch exception2
            exception = addCause(exception2, exception);
            disp(msgStr);
        end
        try
            trEPRgui_bugreportwindow(exception);
        catch exception3
            % If even displaying the bug report window fails...
            exception = addCause(exception3, exception);
            throw(exception);
        end
    end
end     

function colour_type_popupmenu_Callback(source,~)
    try
        % Get handles of main window
        gh = guihandles(hMainFigure);
        
        colourTypes = cellstr(get(source,'String'));
        colourType = colourTypes{get(source,'Value')};
        
        switch colourType
            case 'name'
                set(gh.display_panel_colour_type2_popupmenu,'String',...
                    'b|g|r|c|m|y|k'...
                    );
                set(gh.display_panel_colour_r_edit,'Enable','Off');
                set(gh.display_panel_colour_g_edit,'Enable','Off');
                set(gh.display_panel_colour_b_edit,'Enable','Off');
            case 'RGB'
                set(gh.display_panel_colour_type2_popupmenu,'String',...
                    '0-1|0-255|0-FF'...
                    );
                set(gh.display_panel_colour_r_edit,'Enable','On');
                set(gh.display_panel_colour_g_edit,'Enable','On');
                set(gh.display_panel_colour_b_edit,'Enable','On');
            otherwise
                % That shall never happen
                add2status('trEPRgui_infowindow(): Unknown colour type');
        end
    catch exception
        try
            msgStr = ['An exception occurred. '...
                'The bug reporter should have been opened'];
            add2status(msgStr);
        catch exception2
            exception = addCause(exception2, exception);
            disp(msgStr);
        end
        try
            trEPRgui_bugreportwindow(exception);
        catch exception3
            % If even displaying the bug report window fails...
            exception = addCause(exception3, exception);
            throw(exception);
        end
    end
end

function colour_type2_popupmenu_Callback(source,~)
    try
        % Get appdata of main window
        mainWindow = guiGetWindowHandle(mfilename);
        ad = getappdata(mainWindow);

        % Get handles of main window
        gh = guihandles(mainWindow);

        colourTypes = ...
            cellstr(get(gh.display_panel_colour_type_popupmenu,'String'));
        colourType = ...
            colourTypes{get(gh.display_panel_colour_type_popupmenu,'Value')};
                
        switch colourType
            case 'name'
                colourNames = cellstr(get(source,'String'));
                if ad.control.spectra.active
                    ad.data{ad.control.spectra.active}.line.color = ...
                        colourNames{get(source,'Value')};
                    % Update appdata of main window
                    setappdata(mainWindow,'data',ad.data);
                end
            case 'RGB'
            otherwise
                % That shall never happen
                add2status('trEPRgui_infowindow(): Unknown colour type');
        end
    catch exception
        try
            msgStr = ['An exception occurred. '...
                'The bug reporter should have been opened'];
            add2status(msgStr);
        catch exception2
            exception = addCause(exception2, exception);
            disp(msgStr);
        end
        try
            trEPRgui_bugreportwindow(exception);
        catch exception3
            % If even displaying the bug report window fails...
            exception = addCause(exception3, exception);
            throw(exception);
        end
    end
end

function history_listbox_Callback(source,~)
    try
        % Get appdata of main window
        mainWindow = guiGetWindowHandle(mfilename);
        ad = getappdata(mainWindow);
        
        ad.control.spectra.history{ad.control.spectra.active} = ... 
            get(source,'Value');
        
        % Update appdata of main window
        setappdata(mainWindow,'control',ad.control);
        
        % Update panels
        updateHistoryPanel();
    catch exception
        try
            msgStr = ['An exception occurred. '...
                'The bug reporter should have been opened'];
            add2status(msgStr);
        catch exception2
            exception = addCause(exception2, exception);
            disp(msgStr);
        end
        try
            trEPRgui_bugreportwindow(exception);
        catch exception3
            % If even displaying the bug report window fails...
            exception = addCause(exception3, exception);
            throw(exception);
        end
    end
end

function pushbutton_Callback(~,~,action)
    try
        if isempty(action)
            return;
        end
        
        % Get appdata of main window
        mainWindow = guiGetWindowHandle(mfilename);
        ad = getappdata(mainWindow);

        switch action
            case 'Apply'
                % In case the current dataset is unsaved, remove it from
                % "unsaved", thus preventing the dialogue when closing
                % asking for modified, but unsaved datasets
                if find(ad.control.spectra.unsaved==ad.control.spectra.active)
                    ad.control.spectra.unsaved(...
                        ad.control.spectra.unsaved==ad.control.spectra.active) = [];
                end
                % Update appdata of main window
                setappdata(mainWindow,'control',ad.control);
                % Update dataset display
                updateDatasets();
            case 'Revert'
                % If there are no changes made to the currently active
                % dataset, silently return
                if ~find(ad.control.spectra.modified==ad.control.spectra.active)
                    return;
                end
                % TODO: Show dialogue asking the user whether he/she really
                % would like to discard all changes made to the current
                % dataset
                
                % Revert dataset to "original" dataset as loaded to the
                % info GUI
                ad.data{ad.control.spectra.active} = ...
                    ad.origdata{ad.control.spectra.active};
                % In case the current dataset is unsaved, remove it from
                % "unsaved".
                if find(ad.control.spectra.unsaved==ad.control.spectra.active)
                    ad.control.spectra.unsaved(...
                        ad.control.spectra.unsaved==ad.control.spectra.active) = [];
                end
                % Remove the current dataset from modified. (If it were not
                % modified, we should never end up here, see above.)
                ad.control.spectra.modified(...
                    ad.control.spectra.modified==ad.control.spectra.active) = [];
                % Update appdata of main window
                setappdata(mainWindow,'control',ad.control);
                setappdata(mainWindow,'data',ad.data);
                % Update dataset display and panels
                updateDatasets();
                updateGeneralPanel();
                updateParameterPanel();
                updateDisplayPanel();
                updateHistoryPanel();
            case 'Close'
                % In case there are unsaved datasets, display dialogue
                if ~isempty(ad.control.spectra.unsaved)
                    answer = questdlg(...
                        {'There are modified and still unsaved datasets. Close anyway?'...
                        ' '...
                        'Note that "Close" means that you loose the changes you made.'...
                        ' '...
                        'Other options: "Apply & Close", "Cancel".'},...
                        'Warning: Modified Datasets...',...
                        'Discard & Close','Apply & Close','Cancel',...
                        'Cancel');
                    switch answer
                        case 'Apply & Close'
                            % As we simply want to write the datasets back
                            % to the main GUI in this case, we have to do
                            % nothing in here and pass everything to after
                            % this switch statement, as it will get done
                            % there.
                        case 'Discard & Close'
                            msgStr = 'Closing Info GUI and discarding all changes.';
                            add2status(msgStr);
                            guiClose();
                            return;
                        case 'Cancel'
                            msgStr = {'Closing Info GUI aborted by user. ' ...
                                'Reason: Modified and unsaved datasets'};
                            add2status(msgStr);
                            return;
                        otherwise
                            msgStr = {...
                                sprintf('Info GUI: Unknown answer "%s".',...
                                answer)};
                            add2status(msgStr);
                            return;
                    end

                end
                % In case there are modified datasets, write them back to
                % main GUI
                if ~isempty(ad.control.spectra.modified)
                    for k=1:length(ad.control.spectra.modified)
                        status = refreshDatasetInMainGUI(...
                            ad.data{ad.control.spectra.modified(k)},...
                            ad.control.spectra.modified(k),...
                            'modified',true,...
                            'label',ad.origdata{ad.control.spectra.modified(k)}.label);
                        if status
                            disp('Hmm... some problems with appending modified dataset to main GUI.');
                        end
                    end
                end
                guiClose();
            otherwise
                return;
        end
    catch exception
        try
            msgStr = ['An exception occurred. '...
                'The bug reporter should have been opened'];
            add2status(msgStr);
        catch exception2
            exception = addCause(exception2, exception);
            disp(msgStr);
        end
        try
            trEPRgui_bugreportwindow(exception);
        catch exception3
            % If even displaying the bug report window fails...
            exception = addCause(exception3, exception);
            throw(exception);
        end
    end
end

function keypress_Callback(src,evt)
    try
        if isempty(evt.Character) && isempty(evt.Key)
            % In case "Character" is the empty string, i.e. only modifier key
            % was pressed...
            return;
        end
        if ~isempty(evt.Modifier)
            if (strcmpi(evt.Modifier{1},'command')) || ...
                    (strcmpi(evt.Modifier{1},'control'))
                switch evt.Key
                    case 'w'
                        pushbutton_Callback(src,evt,'Close')
                        return;
                    case '1'
                        switchPanel('General');
                        return;
                    case '2'
                        switchPanel('Parameters');
                        return;
                    case '3'
                        switchPanel('Display');
                        return;
                    case '4'
                        switchPanel('History');
                        return;
                end
            end
        end
        switch evt.Key
            case 'f1'
                trEPRgui_info_helpwindow();
                return;
            otherwise
%                 disp(evt);
%                 fprintf('       Caller: %i\n\n',src);
                return;
        end
    catch exception
        try
            msgStr = ['An exception occurred. '...
                'The bug reporter should have been opened'];
            add2status(msgStr);
        catch exception2
            exception = addCause(exception2, exception);
            disp(msgStr);
        end
        try
            trEPRgui_bugreportwindow(exception);
        catch exception3
            % If even displaying the bug report window fails...
            exception = addCause(exception3, exception);
            throw(exception);
        end
    end
end


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  Utility functions
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

function guiClose()
    try
        % Look for Info GUI Help window and if its there, close as well
        hHelpWindow = guiGetWindowHandle('trEPRgui_info_helpwindow');
        if ishandle(hHelpWindow)
            delete(hHelpWindow);
        end
        msgStr = {'Closing Info GUI.'};
        add2status(msgStr);
        delete(guiGetWindowHandle(mfilename));
    catch exception
        try
            msgStr = ['An exception occurred. '...
                'The bug reporter should have been opened'];
            add2status(msgStr);
        catch exception2
            exception = addCause(exception2, exception);
            disp(msgStr);
        end
        try
            trEPRgui_bugreportwindow(exception);
        catch exception3
            % If even displaying the bug report window fails...
            exception = addCause(exception3, exception);
            throw(exception);
        end
    end 
end

function switchPanel(panelName)
    try
        % Get handles of main window
        mainWindow = guiGetWindowHandle(mfilename);
        gh = guihandles(mainWindow);

        panels = [p1 p2 p3 p4];
        buttons = [tb1 tb2 tb3 tb4];
        switch panelName
            case 'General'
                set(panels,'Visible','off');
                set(buttons,'Value',0);
                set(p1,'Visible','on');
                set(tb1,'Value',1);
                set(gh.main_panel_about_text,'String',...
                    ['General information about the dataset, such as '...
                    'full filename (with path), label, and header '...
                    'information. In case of Bruker BES3T files, '...
                    '"header" displays the content of the DSC file.']);
                updateGeneralPanel()
            case 'Parameters'
                set(panels,'Visible','off');
                set(buttons,'Value',0);
                set(p2,'Visible','on');
                set(tb2,'Value',1);
                set(gh.main_panel_about_text,'String',{...
                    ['All information from the "parameters" structure '...
                    'of the dataset. Most of these parameters are '...
                    'extracted from the raw data. ']...
                    ['Be careful with editing the highlighted '...
                    'fields, as that may corrupt your data!']...
                    });
                updateParameterPanel()
            case 'Display'
                set(panels,'Visible','off');
                set(buttons,'Value',0);
                set(p3,'Visible','on');
                set(tb3,'Value',1);
                set(gh.main_panel_about_text,'String',...
                    ['All settings that control the display of the '...
                    'dataset, including position in x and y, '...
                    'scaling, displacement, smoothing, axis labels '...
                    'and limits, but as well the line style.']);
                updateDisplayPanel()
            case 'History'
                set(panels,'Visible','off');
                set(buttons,'Value',0);
                set(p4,'Visible','on');
                set(tb4,'Value',1);
                set(gh.main_panel_about_text,'String',{...
                    ['Access to the complete history of the dataset '...
                    'including a detailed account of the parameters '...
                    'used for every step in the history. ']...
                    ['If there is a report from a given record, '...
                    'it will be displayed as well.']...
                    });
                updateHistoryPanel()
            otherwise
                msgStr = 'trEPRgui_infowindow(): Unknown panel.';
                add2status(msgStr);
                return;
        end
    catch exception
        try
            msgStr = ['An exception occurred. '...
                'The bug reporter should have been opened'];
            add2status(msgStr);
        catch exception2
            exception = addCause(exception2, exception);
            disp(msgStr);
        end
        try
            trEPRgui_bugreportwindow(exception);
        catch exception3
            % If even displaying the bug report window fails...
            exception = addCause(exception3, exception);
            throw(exception);
        end
    end 
end

function switchParameterPanel(panelName)
    try
        % Get handles of main window
        mainWindow = guiGetWindowHandle(mfilename);
        gh = guihandles(mainWindow);

        panels = [ ...
            gh.parameter_page1_panel ...
            gh.parameter_page2_panel ...
            ];
        buttons = [...
            gh.parameter_page1_togglebutton ...
            gh.parameter_page2_togglebutton ...
            ];
        switch lower(panelName)
            case 'page 1'
                set(panels,'Visible','off');
                set(buttons,'Value',0);
                set(gh.parameter_page1_panel,'Visible','on');
                set(gh.parameter_page1_togglebutton,'Value',1);
            case 'page 2'
                set(panels,'Visible','off');
                set(buttons,'Value',0);
                set(gh.parameter_page2_panel,'Visible','on');
                set(gh.parameter_page2_togglebutton,'Value',1);
            otherwise
                msgStr = 'trEPRgui_infowindow(): Unknown panel.';
                add2status(msgStr);
                return;
        end
    catch exception
        try
            msgStr = ['An exception occurred. '...
                'The bug reporter should have been opened'];
            add2status(msgStr);
        catch exception2
            exception = addCause(exception2, exception);
            disp(msgStr);
        end
        try
            trEPRgui_bugreportwindow(exception);
        catch exception3
            % If even displaying the bug report window fails...
            exception = addCause(exception3, exception);
            throw(exception);
        end
    end 
end

function updateDatasets()
    try
        mainWindow = guiGetWindowHandle(mfilename);
        % Get appdata from ACC GUI
        ad = getappdata(mainWindow);
            
        if isempty(ad.data)
            return;
        end
        
        % Get handle for loaded spectra listbox
        gh = guidata(mainWindow);
        lbox = gh.main_panel_dataset_listbox;
        
        % Get indices of loaded spectra
        loaded = ad.control.spectra.loaded;
        
        % Get names for display in listbox
        if ~isempty(loaded)
            set(lbox,'Enable','on');
            labels = cell(0);
            for k=1:length(loaded)
                if find(ad.control.spectra.unsaved==loaded(k))
                    labels{k} = ['*' ad.data{loaded(k)}.label];
                else
                    labels{k} = ad.data{loaded(k)}.label;
                end
            end
            % Update status display
            set(lbox,'String',labels);
            if (get(lbox,'Value')>length(loaded))
                set(lbox,'Value',length(loaded));
            end
            if ((get(lbox,'Value')==0) && (~isempty(loaded)))
                set(lbox,'Value',1);
            end
        else
            set(lbox,'String','');
            set(lbox,'Enable','off');
            ad.control.spectra.active = [];
        end
        
        % Highlight currently active
        if ad.control.spectra.active
            set(lbox,'Value',find(loaded==ad.control.spectra.active));
        end
        
        % Set appdata of info GUI
        setappdata(mainWindow,'control',ad.control);

    catch exception
        try
            msgStr = ['An exception occurred. '...
                'The bug reporter should have been opened'];
            add2status(msgStr);
        catch exception2
            exception = addCause(exception2, exception);
            disp(msgStr);
        end
        try
            trEPRgui_bugreportwindow(exception);
        catch exception3
            % If even displaying the bug report window fails...
            exception = addCause(exception3, exception);
            throw(exception);
        end
    end 
end

function updateGeneralPanel()
    try
        mainWindow = guiGetWindowHandle(mfilename);
        % Get appdata from info GUI
        ad = getappdata(mainWindow);
        
        if isempty(ad.data)
            return;
        end
        
        % Get handles from info GUI
        gh = guidata(mainWindow);

        [filepath,filename,fileext] = ...
            fileparts(ad.data{ad.control.spectra.active}.file.name);
        if filepath
            filepath = [filepath '/'];
        end
        set(gh.general_panel_filepath_edit,'String',filepath);
        set(gh.general_panel_filename_edit,'String',[filename fileext]);
        set(gh.general_panel_fileformat_edit,'String',...
            ad.data{ad.control.spectra.active}.file.format);
        set(gh.general_panel_label_edit,'String',...
            ad.data{ad.control.spectra.active}.label);
        
        for k=1:length(ad.data{ad.control.spectra.active}.header)
            ad.data{ad.control.spectra.active}.header{k} = ...
                sprintf('%03.0f: %s',...
                k,char(ad.data{ad.control.spectra.active}.header{k}));
        end
        set(gh.general_panel_header_edit,'String',...
            ad.data{ad.control.spectra.active}.header);
        for k=1:length(ad.data{ad.control.spectra.active}.comment)
            ad.data{ad.control.spectra.active}.comment{k} = ...
                sprintf('%03.0f: %s',...
                k,char(ad.data{ad.control.spectra.active}.comment{k}));
        end
        set(gh.general_panel_comment_edit,'String',...
            ad.data{ad.control.spectra.active}.comment);

    catch exception
        try
            msgStr = ['An exception occurred. '...
                'The bug reporter should have been opened'];
            add2status(msgStr);
        catch exception2
            exception = addCause(exception2, exception);
            disp(msgStr);
        end
        try
            trEPRgui_bugreportwindow(exception);
        catch exception3
            % If even displaying the bug report window fails...
            exception = addCause(exception3, exception);
            throw(exception);
        end
    end 
end

function updateParameterPanel()
    try
        mainWindow = guiGetWindowHandle(mfilename);
        % Get appdata from info GUI
        ad = getappdata(mainWindow);
        
        % Get handles from info GUI
        gh = guidata(mainWindow);
        
        % Cell array matching GUI edit fields to data structure
        % The first column contains the GUI edit field tags.
        % The second column contains the default string of the field.
        % The third column contains the corresponding field in the
        % parameters part of the data structure.
        % The fourth column contains an index, in case that the field in
        % the data structure is a vector and a certain field of that is
        % needed.
        matchingSample = {...
            'parameter_panel_samplename_edit','N/A','name',''; ...
            'parameter_panel_sampletube_edit','N/A','tube',''; ...
            'parameter_panel_sampledescription_edit','N/A','description',''; ...
            'parameter_panel_samplepreparation_edit','N/A','preparation',''; ...
            };
        matchingAxes = {...
            'parameter_panel_xmeasure_edit','index','x.measure',''; ...
            'parameter_panel_xunit_edit','points','x.unit',''; ...
            'parameter_panel_ymeasure_edit','index','y.measure',''; ...
            'parameter_panel_yunit_edit','points','y.unit',''; ...
            'parameter_panel_zmeasure_edit','index','z.measure',''; ...
            'parameter_panel_zunit_edit','points','z.unit',''; ...
            };
        matchingParameter = {...
            'parameter_panel_nruns_edit','0','runs',''; ...
            'parameter_panel_date_edit','yyyy-mm-dd','date',''; ...
            'parameter_panel_temperature_edit','0','temperature.value',''; ...
            'parameter_panel_temperature_unit_edit','0','temperature.unit',''; ...
            'parameter_panel_operator_edit','N/A','operator',''; ...
            'parameter_panel_npts_edit','0','transient.points',''; ...
            'parameter_panel_triggerposition_edit','0','transient.triggerPosition',''; ...
            'parameter_panel_length_edit','0','transient.length',''; ...
            'parameter_panel_length_unit_edit','us','transient.unit',''; ...
            'parameter_panel_sensitivity_edit','0','recorder.sensitivity.value',''; ...
            'parameter_panel_sensitivity_unit_edit','mV','recorder.sensitivity.unit',''; ...
            'parameter_panel_averages_edit','0','recorder.averages',''; ...
            'parameter_panel_timebase_edit','0','recorder.timeBase.value',''; ...
            'parameter_panel_timebaseunit_edit','us','recorder.timeBase.unit',''; ...
            'parameter_panel_bandwidth_edit','0','recorder.bandwidth.value',''; ...
            'parameter_panel_bandwidthunit_edit','MHz','recorder.bandwidth.unit',''; ...
            'parameter_panel_recordermodel_edit','N/A','recorder.model',''; ...
            'parameter_panel_recordercoupling_edit','N/A','recorder.coupling',''; ...
            'parameter_panel_recorderimpedance_edit','0','recorder.impedance.value',''; ...
            'parameter_panel_recorderimpedanceunit_edit','MOhm','recorder.impedance.unit',''; ...
            'parameter_panel_fieldstart_edit','0','field.start',''; ...
            'parameter_panel_fieldstartunit_edit','G','field.unit',''; ...
            'parameter_panel_fieldend_edit','0','field.stop',''; ...
            'parameter_panel_fieldendunit_edit','G','field.unit',''; ...
            'parameter_panel_fieldstep_edit','0','field.step',''; ...
            'parameter_panel_fieldstepunit_edit','G','field.unit',''; ...
            'parameter_panel_fieldcontroller_edit','N/A','field.model',''; ...
            'parameter_panel_fieldstartcalibrated_edit','N/A','field.calibration.values',1; ...
            'parameter_panel_fieldendcalibrated_edit','N/A','field.calibration.values',2; ...
            'parameter_panel_fieldprobe_edit','N/A','field.calibration.model',''; ...
            'parameter_panel_mwfrequency_edit','0','bridge.MWfrequency.value',''; ...
            'parameter_panel_attenuation_edit','0','bridge.attenuation.value',''; ...
            'parameter_panel_mwpower_edit','0','bridge.power.value',''; ...
            'parameter_panel_mwpowerunit_edit','mW','bridge.power.unit',''; ...
            'parameter_panel_mwcalibratedstart_edit','N/A','bridge.calibration.values','1'; ...
            'parameter_panel_mwcalibratedend_edit','N/A','bridge.calibration.values','2'; ...
            'parameter_panel_mwcounter_edit','N/A','bridge.calibration.model',''; ...
            'parameter_panel_bridgemodel_edit','N/A','bridge.model',''; ...
            'parameter_panel_wavelength_edit','0','laser.wavelength.value',''; ...
            'parameter_panel_repetitionrate_edit','0','laser.repetitionRate.value',''; ...
            'parameter_panel_laserpower_edit','0','laser.power.value',''; ...
            'parameter_panel_laserpowerunit_edit','mJ','laser.power.unit',''; ...
            'parameter_panel_lasermodel_edit','N/A','laser.model',''; ...
            'parameter_panel_opodye_edit','N/A','laser.opoDye',''; ...
            };
        
        if isempty(ad.data)
            % Set all edit fields to default values
            for k=1:length(matchingParameter)
                set(gh.(matchingParameter{k,1}),'String',matchingParameter{k,2});
            end
            for k=1:size(matchingSample,1)
                set(gh.(matchingSample{k,1}),'String',matchingSample{k,2});
            end
            for k=1:size(matchingAxes,1)
                set(gh.(matchingAxes{k,1}),'String',matchingAxes{k,2});
            end
            return;
        else
            for k=1:length(matchingParameter)
                if ~isempty(matchingParameter{k,3}) && ~isempty(...
                        getCascadedField(...
                        ad.data{ad.control.spectra.active}.parameters,...
                        matchingParameter{k,3}))
                    if ~isempty(matchingParameter{k,4})
                        value = getCascadedField(...
                            ad.data{ad.control.spectra.active}.parameters,...
                            matchingParameter{k,3});
                        set(gh.(matchingParameter{k,1}),'String',...
                            num2str(value(matchingParameter{k,4})));
                    else
                        set(gh.(matchingParameter{k,1}),'String',...
                            getCascadedField(...
                            ad.data{ad.control.spectra.active}.parameters,...
                            matchingParameter{k,3})...
                            );
                    end
                else
                    set(gh.(matchingParameter{k,1}),'String',matchingParameter{k,2});
                end
            end
            for k=1:size(matchingSample,1)
                if ~isempty(matchingSample{k,3}) && ~isempty(...
                        getCascadedField(...
                        ad.data{ad.control.spectra.active}.sample,...
                        matchingSample{k,3}))
                    if ~isempty(matchingSample{k,4})
                        value = getCascadedField(...
                            ad.data{ad.control.spectra.active}.sample,...
                            matchingSample{k,3});
                        set(gh.(matchingSample{k,1}),'String',...
                            num2str(value(matchingSample{k,4})));
                    else
                        set(gh.(matchingSample{k,1}),'String',...
                            getCascadedField(...
                            ad.data{ad.control.spectra.active}.sample,...
                            matchingSample{k,3})...
                            );
                    end
                else
                    set(gh.(matchingSample{k,1}),'String',matchingSample{k,2});
                end
            end
            for k=1:size(matchingAxes,1)
                if ~isempty(matchingAxes{k,3}) && ~isempty(...
                        getCascadedField(...
                        ad.data{ad.control.spectra.active}.axes,...
                        matchingAxes{k,3}))
                    if ~isempty(matchingAxes{k,4})
                        value = getCascadedField(...
                            ad.data{ad.control.spectra.active}.axes,...
                            matchingAxes{k,3});
                        set(gh.(matchingAxes{k,1}),'String',...
                            num2str(value(matchingAxes{k,4})));
                    else
                        set(gh.(matchingAxes{k,1}),'String',...
                            getCascadedField(...
                            ad.data{ad.control.spectra.active}.axes,...
                            matchingAxes{k,3})...
                            );
                    end
                else
                    set(gh.(matchingAxes{k,1}),'String',matchingAxes{k,2});
                end
            end
        end
        % Account for additional field "parameter_panel_fieldpts_edit"
        [y,~] = size(ad.data{ad.control.spectra.active}.data);
        set(gh.parameter_panel_fieldpts_edit,'String',num2str(y));
        
    catch exception
        try
            msgStr = ['An exception occurred. '...
                'The bug reporter should have been opened'];
            add2status(msgStr);
        catch exception2
            exception = addCause(exception2, exception);
            disp(msgStr);
        end
        try
            trEPRgui_bugreportwindow(exception);
        catch exception3
            % If even displaying the bug report window fails...
            exception = addCause(exception3, exception);
            throw(exception);
        end
    end 
end

function updateDisplayPanel()
    try
        mainWindow = guiGetWindowHandle(mfilename);
        % Get appdata from info GUI
        ad = getappdata(mainWindow);

        % Get handles from info GUI
        gh = guidata(mainWindow);
        
        % Cell array matching GUI edit fields to data structure
        % The first column contains the GUI edit field tags.
        % The second column contains the default string of the field.
        % The third column contains the corresponding field in the
        % parameters part of the data structure.
        % The fourth column contains an index, in case that the field in
        % the data structure is a vector and a certain field of that is
        % needed.
        matching = {...
            'display_panel_position_x_index_edit','1','display.position.x',''; ...
            'display_panel_position_y_index_edit','1','display.position.y',''; ...
            'display_panel_scaling_x_index_edit','1','display.scaling.x',''; ...
            'display_panel_scaling_y_index_edit','1','display.scaling.y',''; ...
            'display_panel_scaling_z_index_edit','1','display.scaling.z',''; ...
            'display_panel_displacement_x_index_edit','0','display.displacement.x',''; ...
            'display_panel_displacement_y_index_edit','0','display.displacement.y',''; ...
            'display_panel_displacement_z_index_edit','0','display.displacement.z',''; ...
            'display_panel_average_x_points_edit','1','display.smoothing.x.value',''; ...
            'display_panel_average_y_points_edit','1','display.smoothing.y.value',''; ...
            'display_panel_axislabels_x_measure_edit','index','axes.x.measure',''; ...
            'display_panel_axislabels_y_measure_edit','index','axes.y.measure',''; ...
            'display_panel_axislabels_z_measure_edit','index','axes.z.measure',''; ...
            'display_panel_axislabels_x_unit_edit','points','axes.x.unit',''; ...
            'display_panel_axislabels_y_unit_edit','points','axes.y.unit',''; ...
            'display_panel_axislabels_z_unit_edit','points','axes.z.unit',''; ...
            'display_panel_axislimits_x_min_edit','0','axes.x.values',1; ...
            'display_panel_axislimits_x_max_edit','1','axes.x.values','end'; ...
            'display_panel_axislimits_y_min_edit','0','axes.y.values',1; ...
            'display_panel_axislimits_y_max_edit','1','axes.y.values','end'; ...
            };

        if isempty(ad.data)
            % Set all edit fields to default values
            for k=1:length(matching)
                set(gh.(matching{k,1}),'String',matching{k,2});
            end
            return;
        else
            for k=1:length(matching)
                if ~isempty(matching{k,3}) && ~isempty(...
                        getCascadedField(...
                        ad.data{ad.control.spectra.active},...
                        matching{k,3}))
                    if ~isempty(matching{k,4})
                        value = getCascadedField(...
                            ad.data{ad.control.spectra.active},...
                            matching{k,3});
                        if ischar(matching{k,4}) && ...
                                strcmp(matching{k,4},'end')
                            set(gh.(matching{k,1}),'String',...
                                num2str(value(end)));
                        else
                            set(gh.(matching{k,1}),'String',...
                                num2str(value(matching{k,4})));
                        end
                    else
                        set(gh.(matching{k,1}),'String',...
                            getCascadedField(...
                            ad.data{ad.control.spectra.active},...
                            matching{k,3})...
                            );
                    end
                else
                    set(gh.(matching{k,1}),'String',matching{k,2});
                end
            end
        end
        
    catch exception
        try
            msgStr = ['An exception occurred. '...
                'The bug reporter should have been opened'];
            add2status(msgStr);
        catch exception2
            exception = addCause(exception2, exception);
            disp(msgStr);
        end
        try
            trEPRgui_bugreportwindow(exception);
        catch exception3
            % If even displaying the bug report window fails...
            exception = addCause(exception3, exception);
            throw(exception);
        end
    end 
end

function updateHistoryPanel()
    try
        mainWindow = guiGetWindowHandle(mfilename);
        % Get appdata from info GUI
        ad = getappdata(mainWindow);
        
        % Get handles from info GUI
        gh = guidata(mainWindow);
        
        % To shorten lines, assign Id of currently active dataset
        selectedId = ad.control.spectra.active;
        
        % If no data or no history
        if isempty(ad.data) || isempty(ad.data{selectedId}.history)
            % Empty all strings
            set(gh.history_panel_records_listbox,'String','');
            set(gh.history_panel_records_listbox,'Enable','inactive');
            set(gh.history_panel_date_text,'String','');
            set(gh.history_panel_method_text,'String','');
            set(gh.history_panel_operator_text,'String','');
            set(gh.history_panel_platform_text,'String','');
            set(gh.history_panel_matlabversion_text,'String','');
            set(gh.history_panel_toolboxversion_text,'String','');
            set(gh.history_panel_parameter_edit,'String','');
            set(gh.history_panel_report_edit,'String','');
            return;
        end
        
        % Set selected history record for currently active dataset
        if ~(ad.control.spectra.history{selectedId})
            ad.control.spectra.history{selectedId} = 1;
        end
        historyId = ad.control.spectra.history{selectedId};
        
        % Get labels for history records listbox
        recordLabels = ...
            cell(length(ad.data{selectedId}.history),1);
        for k=1:length(ad.data{selectedId}.history)
            recordLabels{k} = ad.data{selectedId}.history{k}.method;
        end
        % Set history records listbox
        set(gh.history_panel_records_listbox,'Enable','on');
        set(gh.history_panel_records_listbox,'String',recordLabels);
        set(gh.history_panel_records_listbox,'Value',...
            ad.control.spectra.history{selectedId});
        
        % Set summary panel strings
        set(gh.history_panel_date_text,'String',...
            ad.data{selectedId}.history{historyId}.date);
        set(gh.history_panel_method_text,'String',...
            ad.data{selectedId}.history{historyId}.method);
        set(gh.history_panel_operator_text,'String',...
            ad.data{selectedId}.history{historyId}.system.username);
        
        % Set system panel strings
        set(gh.history_panel_platform_text,'String',...
            ad.data{selectedId}.history{historyId}.system.platform);
        set(gh.history_panel_matlabversion_text,'String',...
            ad.data{selectedId}.history{historyId}.system.matlab);
        set(gh.history_panel_toolboxversion_text,'String',...
            ad.data{selectedId}.history{historyId}.system.trEPR);
        
        % Set report panel
        set(gh.history_panel_report_edit,'String',...
            ad.data{selectedId}.history{historyId}.info);

    catch exception
        try
            msgStr = ['An exception occurred. '...
                'The bug reporter should have been opened'];
            add2status(msgStr);
        catch exception2
            exception = addCause(exception2, exception);
            disp(msgStr);
        end
        try
            trEPRgui_bugreportwindow(exception);
        catch exception3
            % If even displaying the bug report window fails...
            exception = addCause(exception3, exception);
            throw(exception);
        end
    end 
end

% --- Get field of cascaded struct
function value = getCascadedField (struct, fieldName)
    % Get number of "." in fieldName
    nDots = strfind(fieldName,'.');
    if isempty(nDots)
        value = struct.(fieldName);
    else
        struct = struct.(fieldName(1:nDots(1)-1));
        value = getCascadedField(...
            struct,...
            fieldName(nDots(1)+1:end));
    end    
end

% --- Set field of cascaded struct
function struct = setCascadedField (struct, fieldName, value)
    % Get number of "." in fieldName
    nDots = strfind(fieldName,'.');
    if isempty(nDots)
        struct.(fieldName) = value;
    else
        if ~isfield(struct,fieldName(1:nDots(1)-1))
            struct.(fieldName(1:nDots(1)-1)) = [];
        end
        innerstruct = struct.(fieldName(1:nDots(1)-1));
        innerstruct = setCascadedField(...
            innerstruct,...
            fieldName(nDots(1)+1:end),...
            value);
        struct.(fieldName(1:nDots(1)-1)) = innerstruct;
    end
end

end