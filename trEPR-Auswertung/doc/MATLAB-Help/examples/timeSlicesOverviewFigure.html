<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="de">
  <head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
   <link rel="shortcut icon" href="eslogo.png" />
   <link rel="stylesheet" type="text/css" href="../style.css" />
   <title>trEPR Toolbox - examples - time slices - overview figure</title>
  </head>
  <body>
	  
	<h1>Examples: Time Slices - Overview at Different Field Positions</h1>
	  
	<p>
      The spectra recorded with transient EPR consist of a set of transients (<a href="examples/timeSlices.html">time slices</a>) recorded at a fixed field position and showing the development of the signal in time. To evaluate the kinetics of the transient signal one normally records the time slices at the maxima and minima positions in the B<sub>0</sub> spectrum with lower B<sub>1</sub> and more accumulations than a complete 2D dataset.
	</p>
	  
	<p>
	  The task of creating a figure showing these time slices recorded at different field positions of interest consists of several steps:
	</p>
      
    <ol>
        <li>Read in the recorded spectra</li>
        <li>Compensate pretrigger offset</li>
        <li>Subtract off-resonance time slice from time slice at signal maximum</li>
        <li>Create time axis</li>
        <li>Plot time slices</li>
        <li>Add title, axes labels and legend</li>
        <li>Save figure to file</li>
    </ol>
      
    <p>
      These steps are outlined in detail in the following paragraphs.
    </p>

    <h2>Read in the recorded spectra</h2>
      
    <p>
      Given that the time slices are recorded using the <a href="http://www.physik.fu-berlin.de/~toerring/fsc2.phtml">fsc2</a> program with the appropriate script one would use the function <a href="../read_fsc2_data.html">read_fsc2_data</a> to read in these spectra:
    </p>

    <code>
      <pre>
% time slices at maximum
[ ts1,f1,fp1,sp1,tp1 ] = read_fsc2_data ( 'timeSlice1.dat' );
[ ts2,f2,fp2,sp2,tp2 ] = read_fsc2_data ( 'timeSlice2.dat' );
[ ts3,f3,fp3,sp3,tp3 ] = read_fsc2_data ( 'timeSlice3.dat' );
[ ts4,f4,fp4,sp4,tp4 ] = read_fsc2_data ( 'timeSlice4.dat' );
% off-resonant time slices
[ tsor,for,fpor,spor,tpor ] = read_fsc2_data ( 'timeSliceor.dat' );
      </pre>
    </code>
      
    <p>
      As you could see here it is necessary not only to record the time slices at the field positions of interest but also one time slice at an &quot;off-resonant&quot; field position that is used later for a baseline correction.
    </p>
      
    <h2>Compensate pretrigger offset</h2>
      
    <p>
      The next step is to compensate for large-scale oscillations and drifts that affect both the signal and the pretrigger signal (dark signal before laser pulse). The function <a href="../pretrigger_offset.html">pretrigger_offset</a> takes the first part of the recorded time slice up to the trigger position (the time of the laser flash) and shifts the whole time slice thus that this &quot;pretrigger&quot; part of the signal has a mean value of zero.
    </p>

    <code>
      <pre>
% time slices at maximum
[ ts1 ] = pretrigger_offset ( ts1, tp1(2) );
[ ts2 ] = pretrigger_offset ( ts2, tp2(2) );
[ ts3 ] = pretrigger_offset ( ts3, tp3(2) );
[ ts4 ] = pretrigger_offset ( ts4, tp4(2) );
% off-resonant time slices
[ tsor ] = pretrigger_offset ( tsor, tpor(2) );
      </pre>
    </code>
      
    <h2>Subtract off-resonance time slice from time slice at signal maximum</h2>
      
    <p>
      As a baseline correction the time slice recorded at the &quot;off-resonant&quot; field position is subtracted from the time slices at the &quot;signal&quot; positions.
    </p>

    <code>
      <pre>
ts1 = mean(ts1) - mean(tsor);
ts2 = mean(ts2) - mean(tsor);
ts3 = mean(ts3) - mean(tsor);
ts4 = mean(ts4) - mean(tsor);
      </pre>
    </code>

    <p>
      The average is done for the case that the off-resonant time slice is recorded at another number of field positions than the signal time slices. (Normally, a time slice is not only recorded at a single field positions, but at two or three field positions with a distance of 0.5 or 1 G.)
    </p>
            
    <h2>Create time axis</h2>
      
    <p>
      Under the assumption that the time parameters of all measurements are the same, one needs not to create time axes for each time slice but can create one time axis for all time slices.
    </p>

    <code>
      <pre>
tp = tp1;
ta = -tp(3)/tp(1)*(tp(2)-1):tp(3)/tp(1):tp(3)-(tp(3)/tp(1)*tp(2));
      </pre>
    </code>
      
    <p>
      This time axis is created using the time parameters read from the fsc2-file.
    </p>

      
    <h2>Plot time slices</h2>
      
    <p>
      After all that work we can finally plot the time slices:
    </p>

    <code>
      <pre>
plot(ta,ts1,ta,ts2,ta,ts3,ta,ts4);
set(gca,'XGrid','on');
      </pre>
    </code>

    <p>
      The grid helps to evaluate the kinetics.
    </p>
      
    <h2>Add title, axes labels and legend</h2>
      
    <p>
      As every figure should have at least a short title describing what it displays, axes labels and, in case of several lines plotted, a legend, we add that now:
    </p>

    <code>
      <pre>
xlabel('time / us');
ylabel('intensity / V');
title('Time slices at different field positions @ [MW attenuation]\n [organism] [sample name] @ [MW frequency], [temperature]');
legend('[field pos 1] G','[field pos 2] G','[field pos 3] G','[field pos 4] G');
      </pre>
    </code>

      
    <h2>Save figure to file</h2>
      
    <p>
      In the end it is a good idea to save the created figure to a file. This is done with the function <a href="save_figure">save_figure</a> that saves the current figure window as MATLAB<sup>TM</sup> as well as <acronym title="Encapsulated PostScript">EPS</acronym> file.
    </p>
% save figure to file
      <code>
        <pre>
save_figure ( figure1filename );
        </pre>
      </code>

% second figure with scaled time slices

% plot time slices
plot(ta,ts1,ta,ts2*(min(ts1)/min(ts2)),ta,ts3*(max(ts4)/max(ts3)),ta,ts4);
%-%plot(ta,ts30dB,ta,ts35dB,ta,ts40dB,ta,ts45dB,ta,ts50dB);
set(gca,'XGrid','on');

% add title, axes labels and legend
xlabel('time / us');
ylabel('intensity / V');
title(titlestring);

legend('3440 G','3450 G','3463 G','3477 G');

% save figure to file
save_figure ( figure2filename );

  </body>
</html>